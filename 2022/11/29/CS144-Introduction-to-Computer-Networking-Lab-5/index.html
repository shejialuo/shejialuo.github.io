<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Website mata -->
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<!-- Disable transformation -->
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<!-- Website description -->

<meta name="description" content="CS144: Introduction to Computer Networking Lab 5" />


<!-- Website keywords -->

<meta name="keywords" content="技术, 学习, 洛的藏书阁" />




<!-- Website rss -->

<link rel="alternate" href="/atom.xml" title="洛的藏书阁" type="application/atom+xml">


<!-- Website favicon -->

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=3.0.0" />


<!-- Canonical, good for google search engine -->
<link rel="canonical" href="https://luolibrary.com/2022/11/29/CS144-Introduction-to-Computer-Networking-Lab-5/" />

<!-- Fancybox styling -->

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />


<!-- MathJax (LaTeX) support -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });  
  </script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<!-- Theme styling -->
<link rel="stylesheet" type="text/css" href="/css/style.css?v=3.0.0" />

<!-- Analytics and push -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7M238H24L4"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'G-7M238H24L4');
</script>

  



<!-- LeanCloud Counter -->


<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null,"server_url":null,"cdn":null},"toc":true,"fancybox":true,"latex":true};
</script>
  
  <title>CS144: Introduction to Computer Networking Lab 5 - 洛的藏书阁</title>

<meta name="generator" content="Hexo 7.2.0"></head>

<body>
  <div class="scrollPercentage"></div>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">洛的藏书阁</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
    <a href="/">
      <li class="mobile-menu-item">
        
        
        Home              </li>
    </a>
    
    <a href="/archives/">
      <li class="mobile-menu-item">
        
        
        Archives              </li>
    </a>
    
    <a href="/tags/">
      <li class="mobile-menu-item">
        
        
        Tags              </li>
    </a>
    
    <a href="/categories/">
      <li class="mobile-menu-item">
        
        
        Categories              </li>
    </a>
    
    <a href="/about/">
      <li class="mobile-menu-item">
        
        
        About              </li>
    </a>
    
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
      <div class="logo-wrapper">  
  <a href="/." class="logo">洛的藏书阁</a>  
</div>  
  
<nav class="site-navbar">  
    
    <ul id="menu" class="menu">  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/">  
              
              
              Home  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/archives/">  
              
              
              Archives  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/tags/">  
              
              
              Tags  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/categories/">  
              
              
              Categories  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/about/">  
              
              
              About  
              
          </a>  
        </li>  
        
    </ul>  
    
</nav>  

    </header>
    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      CS144: Introduction to Computer Networking Lab 5
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2022-11-29
      </span>
      
      
      <span class="post-category">
        
        <a href="/categories/CS144/">CS144</a>
        
      </span>
      
      
    </div>
  </header>

  
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Auxiliary-functions"><span class="toc-number">1.</span> <span class="toc-text">Auxiliary functions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code"><span class="toc-number">2.</span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#send-datagram"><span class="toc-number">2.1.</span> <span class="toc-text">send_datagram</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#recv-frame"><span class="toc-number">2.2.</span> <span class="toc-text">recv_frame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tick"><span class="toc-number">2.3.</span> <span class="toc-text">tick</span></a></li></ol></li></ol>
    </div>
  </div>
  

  <div class="post-content">
    
    <p>You can get the whole series from <a href="https://luolibrary.com/categories/CS144/">here</a></p>
<hr>
<p>First you should carefully read the docs provided by lab. I give some important things here.</p>
<blockquote>
<p>If the destination Ethernet address is unknown, broadcast an ARP request for the next hop’s Ethernet address and queue the IP datagram so it can be sent after the ARP reply is received. If the network already interface already sent an ARP request about the same IP address in the last five seconds, don’t send a second request.</p>
</blockquote>
<p>For the above description, it is obvious that we need to stores the IP datagram and also the time since it has been sent. When we receive a new IP datagram we need to check whether it is in the list. I use the following data structure:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! information for the block ethernet frame and the time since it has been sent</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BlockedEthernetFrame</span> &#123;</span><br><span class="line">    EthernetFrame _frame&#123;&#125;;</span><br><span class="line">    <span class="type">size_t</span> _time&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//! mapping from next-hop-ip to BlockedEthernetFrame</span></span><br><span class="line">std::unordered_map&lt;<span class="type">uint32_t</span>, BlockedEthernetFrame&gt; blocked&#123;&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>If the inbound frame is ARP, parse the payload as an <code>ARPMessage</code> and, if successful, remember the mapping between the sender’s IP address and Ethernet address for 30 seconds</p>
</blockquote>
<p>As you can see, we need to maintain the mapping cache from ip address to the Ethernet address and with expiration time 30 seconds. I use the following data structure.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! information for the Ethernet cache</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">EthernetEntry</span> &#123;</span><br><span class="line">    EthernetAddress _mac&#123;&#125;;</span><br><span class="line">    <span class="type">size_t</span> _time&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//! the mapping cache from next-hop-ip to EthernetAddress</span></span><br><span class="line">std::unordered_map&lt;<span class="type">uint32_t</span>, EthernetEntry&gt; _arp_cache&#123;&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Auxiliary-functions"><a href="#Auxiliary-functions" class="headerlink" title="Auxiliary functions"></a>Auxiliary functions</h2><p>For this lab, we need to create <code>EthernetFrame</code> with different type (<code>TYPE_IPv4</code> and <code>TYPE_ARP</code>) and with different payload. For <code>TYPE_IPv4</code>, we do not consider payload, for <code>TYPE_ARP</code>, we need to consider its payload, we need to create the <code>ARPMessage</code> class.</p>
<p>So I first define a function named <code>new_ethernet_frame</code>, which unifies the process of creating different kinds of <code>EthernetFrame</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">EthernetFrame <span class="title">NetworkInterface::new_ethernet_frame</span><span class="params">(<span class="type">uint16_t</span> type,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                   EthernetAddress src,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                   EthernetAddress dst,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                   BufferList payload)</span> </span>&#123;</span><br><span class="line">    EthernetFrame frame&#123;&#125;;</span><br><span class="line">    frame.<span class="built_in">header</span>().type = type;</span><br><span class="line">    frame.<span class="built_in">header</span>().src = src;</span><br><span class="line">    frame.<span class="built_in">header</span>().dst = dst;</span><br><span class="line">    frame.<span class="built_in">payload</span>() = payload;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NetworkInterface::set_ethernet_frame_dst</span><span class="params">(EthernetFrame &amp;frame, EthernetAddress dst)</span> </span>&#123; frame.<span class="built_in">header</span>().dst = dst; &#125;</span><br></pre></td></tr></table></figure>

<p>Then, i define a function named <code>create_arp_message</code>, which creates <code>ARPMessage</code> instance.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ARPMessage <span class="title">NetworkInterface::create_arp_message</span><span class="params">(<span class="type">uint32_t</span> sender_ip_address,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                EthernetAddress sender_ethernet_address,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                <span class="type">uint32_t</span> target_ip_address,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                EthernetAddress target_ethernet_address,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                <span class="type">uint16_t</span> opcode)</span> </span>&#123;</span><br><span class="line">    ARPMessage message&#123;&#125;;</span><br><span class="line">    message.sender_ip_address = sender_ip_address;</span><br><span class="line">    message.sender_ethernet_address = sender_ethernet_address;</span><br><span class="line">    message.target_ip_address = target_ip_address;</span><br><span class="line">    message.target_ethernet_address = target_ethernet_address;</span><br><span class="line">    message.opcode = opcode;</span><br><span class="line">    <span class="keyword">return</span> message;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><p>This lab is not difficult, you could see my code for explanation, there are a lot of comments which describe the intent of the code.</p>
<h3 id="send-datagram"><a href="#send-datagram" class="headerlink" title="send_datagram"></a>send_datagram</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">NetworkInterface::send_datagram</span><span class="params">(<span class="type">const</span> InternetDatagram &amp;dgram, <span class="type">const</span> Address &amp;next_hop)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// convert IP address of next hop to raw 32-bit representation (used in ARP header)</span></span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> next_hop_ip = next_hop.<span class="built_in">ipv4_numeric</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create a ipv4 type EthernetFrame</span></span><br><span class="line">    EthernetFrame ipv4_ethernet_frame =</span><br><span class="line">        <span class="built_in">new_ethernet_frame</span>(EthernetHeader::TYPE_IPv4, _ethernet_address, &#123;&#125;, dgram.<span class="built_in">serialize</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When the hardware address is in cache and it does not expire.</span></span><br><span class="line">    <span class="keyword">if</span> (_arp_cache.<span class="built_in">find</span>(next_hop_ip) != _arp_cache.<span class="built_in">end</span>() &amp;&amp; _arp_cache[next_hop_ip]._time &lt;= <span class="number">30000</span>) &#123;</span><br><span class="line">        <span class="built_in">set_ethernet_frame_dst</span>(ipv4_ethernet_frame, _arp_cache[next_hop_ip]._mac);</span><br><span class="line">        <span class="built_in">frames_out</span>().<span class="built_in">push</span>(ipv4_ethernet_frame);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// We do not allow ARP flood, add a rate limit</span></span><br><span class="line">        <span class="keyword">if</span> (blocked.<span class="built_in">find</span>(next_hop_ip) != blocked.<span class="built_in">end</span>() &amp;&amp; blocked[next_hop_ip]._time &lt;= <span class="number">5000</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        ARPMessage arp_message = <span class="built_in">create_arp_message</span>(</span><br><span class="line">            _ip_address.<span class="built_in">ipv4_numeric</span>(), _ethernet_address, next_hop_ip, &#123;&#125;, ARPMessage::OPCODE_REQUEST);</span><br><span class="line">        EthernetFrame arp_ethernet_frame = <span class="built_in">new_ethernet_frame</span>(EthernetHeader::TYPE_ARP,</span><br><span class="line">                                                              _ethernet_address,</span><br><span class="line">                                                              ETHERNET_BROADCAST,</span><br><span class="line">                                                              BufferList&#123;std::<span class="built_in">move</span>(arp_message.<span class="built_in">serialize</span>())&#125;);</span><br><span class="line"></span><br><span class="line">        BlockedEthernetFrame new_blocked_datagram&#123;&#125;;</span><br><span class="line">        new_blocked_datagram._time = <span class="number">0</span>;</span><br><span class="line">        new_blocked_datagram._frame = ipv4_ethernet_frame;</span><br><span class="line"></span><br><span class="line">        blocked.<span class="built_in">insert</span>(&#123;next_hop_ip, new_blocked_datagram&#125;);</span><br><span class="line">        <span class="built_in">frames_out</span>().<span class="built_in">push</span>(arp_ethernet_frame);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="recv-frame"><a href="#recv-frame" class="headerlink" title="recv_frame"></a>recv_frame</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">optional&lt;InternetDatagram&gt; <span class="title">NetworkInterface::recv_frame</span><span class="params">(<span class="type">const</span> EthernetFrame &amp;frame)</span> </span>&#123;</span><br><span class="line">    optional&lt;InternetDatagram&gt; new_datagram&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We need to check whether the EthernetFrame is correct</span></span><br><span class="line">    <span class="keyword">if</span> (frame.<span class="built_in">header</span>().dst != _ethernet_address &amp;&amp; frame.<span class="built_in">header</span>().dst != ETHERNET_BROADCAST) &#123;</span><br><span class="line">        <span class="keyword">return</span> new_datagram;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the EthernetFrame type is IPv4, we just parse its payload</span></span><br><span class="line">    <span class="comment">// to get the ip segment</span></span><br><span class="line">    <span class="keyword">if</span> (frame.<span class="built_in">header</span>().type == frame.<span class="built_in">header</span>().TYPE_IPv4) &#123;</span><br><span class="line">        InternetDatagram ipv4_datagram&#123;&#125;;</span><br><span class="line">        ipv4_datagram.<span class="built_in">parse</span>(frame.<span class="built_in">payload</span>());</span><br><span class="line">        new_datagram.<span class="built_in">emplace</span>(ipv4_datagram);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ARPMessage arp_message&#123;&#125;;</span><br><span class="line">        arp_message.<span class="built_in">parse</span>(frame.<span class="built_in">payload</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If it asks for mac</span></span><br><span class="line">        <span class="keyword">if</span> (arp_message.target_ip_address != _ip_address.<span class="built_in">ipv4_numeric</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> new_datagram;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// As long as we receive a ARPMessage, we should update the cache and</span></span><br><span class="line">        <span class="comment">// pushes the ipv4 segment.</span></span><br><span class="line">        _arp_cache[arp_message.sender_ip_address]._mac = arp_message.sender_ethernet_address;</span><br><span class="line">        _arp_cache[arp_message.sender_ip_address]._time = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">auto</span> iter = blocked.<span class="built_in">find</span>(arp_message.sender_ip_address);</span><br><span class="line">        <span class="keyword">if</span> (iter != blocked.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            iter-&gt;second._frame.<span class="built_in">header</span>().dst = arp_message.sender_ethernet_address;</span><br><span class="line">            <span class="built_in">frames_out</span>().<span class="built_in">push</span>(iter-&gt;second._frame);</span><br><span class="line">            blocked.<span class="built_in">erase</span>(iter);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// When sending</span></span><br><span class="line">        <span class="keyword">if</span> (arp_message.opcode == arp_message.OPCODE_REQUEST) &#123;</span><br><span class="line">            ARPMessage message = <span class="built_in">create_arp_message</span>(_ip_address.<span class="built_in">ipv4_numeric</span>(),</span><br><span class="line">                                                    _ethernet_address,</span><br><span class="line">                                                    arp_message.sender_ip_address,</span><br><span class="line">                                                    arp_message.sender_ethernet_address,</span><br><span class="line">                                                    ARPMessage::OPCODE_REPLY);</span><br><span class="line"></span><br><span class="line">            EthernetFrame arp_ethernet_frame = <span class="built_in">new_ethernet_frame</span>(EthernetHeader::TYPE_ARP,</span><br><span class="line">                                                                  _ethernet_address,</span><br><span class="line">                                                                  arp_message.sender_ethernet_address,</span><br><span class="line">                                                                  BufferList&#123;std::<span class="built_in">move</span>(message.<span class="built_in">serialize</span>())&#125;);</span><br><span class="line">            <span class="built_in">frames_out</span>().<span class="built_in">push</span>(arp_ethernet_frame);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> new_datagram;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="tick"><a href="#tick" class="headerlink" title="tick"></a>tick</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">NetworkInterface::tick</span><span class="params">(<span class="type">const</span> <span class="type">size_t</span> ms_since_last_tick)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// We should iterate the `blocked`</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;entry : blocked) &#123;</span><br><span class="line">        entry.second._time += ms_since_last_tick;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// We should iterate the `_arp_cache`</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;cache : _arp_cache) &#123;</span><br><span class="line">        cache.second._time += ms_since_last_tick;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    
  </div>

  
  <!-- Post Copyright -->

<div class="post-copyright">
  <p class="copyright-item">
    <span>Author: </span>
    <a href="https://luolibrary.com">shejialuo</a>
  </p>
  <p class="copyright-item">
    <span>Link: </span>
    <a href="https://luolibrary.com/2022/11/29/CS144-Introduction-to-Computer-Networking-Lab-5/">https://luolibrary.com/2022/11/29/CS144-Introduction-to-Computer-Networking-Lab-5/</a>
  </p>
  <p class="copyright-item">
    <span>License: </span>
    
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a>
  </p>
</div>

    

  

  
  <footer class="post-footer">
    
    <div class="post-tags">
      
      <a href="/tags/%E6%8A%80%E6%9C%AF/">技术</a>
      
      <a href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a>
      
    </div>
    
      
  <nav class="post-nav">  
      
      <a class="prev" href="/2022/11/30/CS144-Introduction-to-Computer-Networking-Lab-6-lab-7/">  
        <i class="iconfont icon-left"></i>  
        <span class="prev-text nav-default">CS144: Introduction to Computer Networking Lab 6 & lab 7</span>  
        <span class="prev-text nav-mobile">Prev</span>  
      </a>  
      
      
      <a class="next" href="/2022/11/28/CS144-Introduction-to-Computer-Networking-Lab-4/">  
        <span class="next-text nav-default">CS144: Introduction to Computer Networking Lab 4</span>  
        <span class="prev-text nav-mobile">Next</span>  
        <i class="iconfont icon-right"></i>  
      </a>  
      
  </nav>  
  

  </footer>
  

</article>
        </div>
          
  <div class="comments" id="comments">  
      
      <div id="utterances-container"></div>  
      
  </div>  
  

      </div>
    </main>
    <footer id="footer" class="footer">
      <!-- Social Links -->

<div class="social-links">
  
  
  
  
  <a href="mailto:shejialuo@gmail.com" class="iconfont icon-email" title="email"></a>
  
  
  
  
  
  
  
  
  
  <a target="_blank" rel="noopener" href="https://twitter.com/luo_hope" class="iconfont icon-twitter" title="twitter"></a>
  
  
  
  
  
  
  
  
  
  <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/jialuo-she-913873289/" class="iconfont icon-linkedin" title="linkedin"></a>
  
  
  
  
  
  
  
  
  
  <a target="_blank" rel="noopener" href="https://github.com/shejialuo" class="iconfont icon-github" title="github"></a>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

  
  <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
  
</div>



<div class="copyright">

  <span class="copyright-year">
    <span>
      
      &copy;
      
      2020 - 2024      
    </span>

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>

    <span class="author">shejialuo</span>
  </span>

</div>
    </footer>
    <div class="back-to-top" id="back-to-top"> <i class="iconfont icon-up"></i> </div>
  </div>
    
    
    
    
    
  
<script>
  var container = document.getElementById('utterances-container');
  var script = document.createElement('script');
  script.src = 'https://utteranc.es/client.js';
  script.setAttribute('repo', 'shejialuo/shejialuo.github.io');
  script.setAttribute('issue-term', 'pathname');
  script.setAttribute('theme', 'github-light');
  script.setAttribute('label', 'Comment');
  script.crossorigin = 'anonymous';
  script.async = true;

  container.appendChild(script);
</script>
  
    
  

  







<script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>



<script type="text/javascript" src="/lib/slideout/slideout.js"></script>



<script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>



<!-- mermaid -->

  <script src='https://unpkg.com/mermaid@9.2.0/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>


  <script type="text/javascript" src="/js/src/even.js?v=3.0.0"></script>
</body>

</html>