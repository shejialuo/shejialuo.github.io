<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>洛的藏书阁</title>
  
  
  <link href="https://luolibrary.com/atom.xml" rel="self"/>
  
  <link href="https://luolibrary.com/"/>
  <updated>2025-12-25T15:56:31.027Z</updated>
  <id>https://luolibrary.com/</id>
  
  <author>
    <name>shejialuo</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2025年终总结</title>
    <link href="https://luolibrary.com/2025/12/25/2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>https://luolibrary.com/2025/12/25/2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2025-12-25T15:56:18.000Z</published>
    <updated>2025-12-25T15:56:31.027Z</updated>
    
    <content type="html"><![CDATA[<p>早在几天前，我就已经决定要写2025年的年终总结了。然而，此时此刻，我如同2024年一样坐在上海的小小出租屋里，放在键盘上的手准备刻下今年的存在。我的内心突然悸动起来，在每天的日常中，我很难感觉到时间的流逝。而在静下心来的今晚，阅读着我在2024年写下的年终总结，才意识到递嬗而过的季节是如此冷淡无情。</p><p>我不禁地望了望窗户外面，似乎想去寻找什么东西？看着路灯闪烁着微弱的橘黄色的光芒，如此熟悉的风景我为何觉得如此陌生呢？一定是我忽略了自己的日常，突然迷惘从心中弥漫开来。耳机传来的音乐把我从妄想拉回了现实，内心突然感到了久违的宁静。迷惘并没有就此消失，但在这份宁静里，我开始想起这一年里那些真正让我觉得有所依托的事情。</p><h2 id="继续在开源世界努力：Git"><a href="#继续在开源世界努力：Git" class="headerlink" title="继续在开源世界努力：Git"></a>继续在开源世界努力：Git</h2><p>2024年，在导师<a href="https://github.com/pks-t">Patrick</a>和<a href="https://github.com/KarthikNayak">Karthik</a>的指导下，我幸运地留在了Git社区。带着对自己方向更清晰的认识，我继续推进此前尚未完成的工作，并陆续处理了一些问题修复，总共提交了25个commit。</p><ul><li><a href="https://github.com/git/git/commit/b4269ebf3591b51bd0463057b97e1786123b74d1">refs-symref-referent-fix</a></li><li><a href="https://github.com/git/git/commit/de35b7b3ffb6e642b47f748eb38e31182377fb0a">Add ref consistency check for packed backend</a></li><li><a href="https://github.com/git/git/commit/d8b48af39141d4552e6e2c091957a59b806808a1">use-mmap-to-check-packed-refs</a></li><li><a href="https://github.com/git/git/commit/c38b74f28618d71cf4987aa215d1f7c432a318ac">ref-contents-check-fix</a></li><li><a href="https://github.com/git/git/commit/2b5bf70039b027ce37ec2a5442499bb9061c2da0">string-list API clean series 1</a></li><li><a href="https://github.com/git/git/commit/048625a6898f2bcc212f0d4baec1d18695b028a5">string-list API clean series 2</a></li></ul><p>最令我感到自豪的，是在2024年还只是学生的我，如今已经能够和导师Patrick一起，指导了来自印度的<a href="https://github.com/inosmeet">Meet Soni</a>完成<a href="https://summerofcode.withgoogle.com/programs/2025/projects/xVrT5e2q">Consolidate ref-related functionality into git-refs</a>这个项目。我很开心，自己的生命力越来越强了，至少，我认为自己在努力且认真地活着。纵使，我经常会怀疑自己，会质疑自己，坚持的意义到底是什么呢？努力的意义是什么呢？我至今仍然无法找到这些问题的答案。但是，我很开心自己在做自己。</p><h3 id="德国的旅行"><a href="#德国的旅行" class="headerlink" title="德国的旅行"></a>德国的旅行</h3><h4 id="与导师的相见"><a href="#与导师的相见" class="headerlink" title="与导师的相见"></a>与导师的相见</h4><p>正是因为今年成为了导师，很幸运地能够代表Git社区去参加谷歌举办的GSoC Mentor Summit。也正是因为这个契机，我经历了许多第一次。第一次办理德国申根签证，第一次的出国旅行，第一次通过自己的双眼去看了外面的世界。</p><p>最令我感慨的，是在德国见到了两位一直在线上陪伴我的导师Patrick和Karthik。当第一次在现实中看见Patrick时，那一刻仿佛有人从屏幕里走了出来，这种不真实的感觉一瞬间冲击了我。随后，我的副导师Karthik也到了，我很开心地给他们分享了我从四川仁寿带到德国的张三芝麻糕。我真心觉得自己很幸运，在即将毕业的那一年选择了参加GSoC。我从来没有想到自己能走到这一步，能和来自地球另一端的人建立连接。本来形同陌路的我们，通过开源建立了连接，认识了彼此。</p><p>然而，Patrick对我的离别的话语至今仍然在我的脑海里面回荡。</p><blockquote><p>See you again in the git mailing list (我们会在Git邮件列表中再见。)</p></blockquote><p>在我看来，这是多么浪漫的一句话，因为我们的相遇本就是在Git邮件列表里面，哪怕面临离别，我们也会继续在Git邮件列表中相见。</p><h4 id="GSoC-Mentor-Summit"><a href="#GSoC-Mentor-Summit" class="headerlink" title="GSoC Mentor Summit"></a>GSoC Mentor Summit</h4><p>GSoC Mentor Summit在慕尼黑召开，会议的形式出乎意料地自由——没有固定议程，没有严肃的报告，大家只是随意地聊天、交流。一开始我很不适应这种氛围，腼腆得不知道该怎么开口，放不开自己。但混熟了之后，这种拘谨渐渐消散了。和来自世界各地的开发者、导师们一起聊项目、聊代码、聊各自的故事，那种自在而平等的氛围，是我从未体验过的。</p><p>然而，最令我感触深刻的就是留言册的话语：</p><p><img src="https://s2.loli.net/2025/12/25/rX1D4SN9w2KMuaW.jpg" alt="Thank you for the ticket to life"></p><blockquote><p>Thank you for the ticket to life (感谢您赐予我生命的入场券。)</p></blockquote><p>我无法用语言表达出我对这句话的感受。我想这是因为这句话让我感到了深深的共鸣，我何尝不是通过GSoC找到了一些自己的存在意义呢？伴随着这些想法，我也在留言册留下了我的心情：</p><blockquote><p>Last year, I was mentored by Git community. My two mentors Patrick and karthik brought me into the world of open source, which makes me find the meaning of life. This year, I, become a mentor to try to bring other students into the open source. This is the power of the GSoC and open source. It connects each other all over the world. And I wouldn’t forget about this experience. GSoC is a such wonderful thing. Thank Google to make us all here. (去年，我在Git社区接受了指导。我的两位导师Patrick和Karthik把我带入了开源世界，让我找到了人生的意义。今年，我成为了一名导师，尝试将其他学生引入开源领域。这就是GSoC和开源的力量——它将世界各地的人们连接在一起。我永远不会忘记这段经历。GSoC是如此美好的事物。感谢Google让我们相聚于此。)</p></blockquote><h2 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h2><h3 id="旅行"><a href="#旅行" class="headerlink" title="旅行"></a>旅行</h3><p>我今年很感谢我的兄弟们，他们拉着我走了很多地方。我知道，如果只是我一个人，大概很难有这么大的动力。我买了属于自己的相机（花了我一大笔钱，很肉疼，不过觉得很值得），走了相当多的地方。</p><p>五一节，我坐高铁去往了青岛，人生第一次近距离地看见了大海。六月的季度假，和朋友们一起前往香港和广东，在南澳看到了蓝得发透的大海，仿佛心灵被洗刷了一般。9月的季度假前往了桂林体验了桂林山水甲天下。10月前往了德国，跨越了半个地球，欣赏风景并与我的导师会面。翻看相机里的照片时，我第一次明白：拍照不是为了拍得多美，而是为了留下痕迹。</p><h3 id="财务管理"><a href="#财务管理" class="headerlink" title="财务管理"></a>财务管理</h3><p>今年最大的收获就是接触到了<a href="https://beancount.github.io/docs/">beancount</a>这个财务管理工具。我也是在今年6月份通过<a href="https://byvoid.com/zhs/blog/beancount-bookkeeping-1/">Beancount复式记账（一）：为什么</a>这篇文章了解到了这个工具，并通过半年的时间，了解其原理，把自己从实习以来的工资收入和支出全部记录了下来。我第一次了解到了我的日常支出和收入情况，我第一次明白了复式记账法的厉害之处，并不是说看自己花了多少钱，而是基于数据的方式认识了我自己。</p><h3 id="和室友的相聚"><a href="#和室友的相聚" class="headerlink" title="和室友的相聚"></a>和室友的相聚</h3><p>今年12月份初的时候，去见了在无锡的大学室友。我和他已经两年没见了。当时他还在上海读书，我当时也在上海实习。每次的这种相聚，总会意识到时间的无情流逝。互相聊了一下各自的生活，一个下午就过去了。时间似乎回到了2020年的时候，我们在重庆交通大学南岸校区慧园的时光。我们似乎变了，但似乎什么也没变。</p><h2 id="自我"><a href="#自我" class="headerlink" title="自我"></a>自我</h2><p>我其实一直不希望自己在小小的出租屋里面腐烂，然而我有时候觉得自己什么也没做，平白无故的浪费宝贵的时间的时候，我就会说出下面的话语（拖我的福，我们有个微信群名改成了“明天别腐烂了”）</p><blockquote><p>在小小的出租屋里腐烂。</p></blockquote><p>写到这儿，我的思绪开始翻滚了起来，再次望了望窗外，夜已经深了，寂静弥漫在这小小的出租屋里面。我不禁问我自己：今年的我做了自己吗？倒不如说自己认为应该追寻的自我到底是不是正确的答案呢？自己是否鲜明地活着呢？</p><p>其实我自己给不出这些问题的答案，或者说这些问题本来就没有答案。然而，我唯一不想做的事情就是：<strong>输给自己</strong>。</p><blockquote><p>输给了雨　输给了风　也输给了冰雪和夏季的暑气<br>即便如此　我也不能输给自己</p></blockquote><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>耳边的音乐声仍然没有停，我听着amazarashi的《ナガルナガル》（《不断流淌》），看着歌词又陷入了沉思。</p><blockquote><p>眼泪流下　时间流淌　你得比它们跑得要更快些<br>街景会变　人也会变　就连昨天没能实现的愿望也是<br>别说丢就丢啊</p></blockquote><p>最终我再次望向窗外，看到镜面上反射的模糊不清的自我，希望明年自己也能继续做自己。在这无意义的世界中，刻下自己的意义。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;早在几天前，我就已经决定要写2025年的年终总结了。然而，此时此刻，我如同2024年一样坐在上海的小小出租屋里，放在键盘上的手准备刻下今年的存在。我的内心突然悸动起来，在每天的日常中，我很难感觉到时间的流逝。而在静下心来的今晚，阅读着我在2024年写下的年终总结，才意识到递</summary>
        
      
    
    
    
    <category term="category_name" scheme="https://luolibrary.com/categories/category-name/"/>
    
    
  </entry>
  
  <entry>
    <title>Air</title>
    <link href="https://luolibrary.com/2025/08/16/Air/"/>
    <id>https://luolibrary.com/2025/08/16/Air/</id>
    <published>2025-08-16T14:18:20.000Z</published>
    <updated>2025-08-16T15:01:13.183Z</updated>
    
    <content type="html"><![CDATA[<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>从我个人的角度来看，《Air》并不是一部很好的作品。翼人是这部作品的核心主角，地球上所有发生过的事情都会通过记忆的形式寄宿于翼人的羽翼上，伴随着岁月的积累，悲伤的回忆给翼人带来诅咒。</p><p>游戏最开始必须通过Dream篇，也就是三个主角线：佳乃线、美凪线和观铃线。这三个线其实对于翼人的引入作用都极其有限。在佳乃线中，羽毛如同一个魔法道具，最后介绍这个羽毛背后的回忆时候，如同强行解释一般。在观铃线中，直接承载翼人设定。唯独在美凪线中，基于“梦”这个机制连接起了翼人的设定。</p><p>Summer篇的氛围塑造我是很满意的，然而我认为这篇是硬伤。在过了三位女主线后，突然跳到了过去，这种切换是极其僵硬的，在三位女主线的篇章中，没有对这个剧情的铺垫。完全就是把这个过去灌输给读者，在阅读的时候因为氛围的影响，不会觉得有问题，但是一旦回过味来，就觉得莫名其妙。</p><p>Air篇其实更加糟糕，我始终难以理解的就是观铃和晴子之间的亲情，或者说我无法理解作品塑造出来的亲情。实际上晴子对观铃并不是那么的冷漠，真正的冷漠是毫不在意。然而，晴子在本篇章的转变是没有铺垫的。这就让我感觉到了割裂，在Dream的观铃线中对晴子的描写并不是很多，直接用亲情催泪，然而并没有对晴子的心灵刻画和成长进行描写，这是最大的败笔。至于轮回这个主题，我认为根本没有表达（逃。</p><p>相反，我反而认为整部作品写的最好就是美凪线。美凪线是唯一能看见成长的线。美凪清楚地认识到自己只是在假装扇动翅膀，活在梦中。然而我们不也是活在梦中吗？</p><blockquote><p>铁丝网外的天空，已经染上夜色。<br>环顾天空，看到远方天空一只彷徨的鸟。<br>美凪：我的翅膀……已经忘记该如何飞翔。<br>远野望着鸟儿，悲伤地说着。<br>美凪：我只是……一直在装作扇动翅膀而已……<br>美凪：不知不觉……我连天空的广阔……还有大地的温暖都已经忘记了。<br>她微微上扬的嘴角，看起来十分自嘲。<br>美凪：……无法飞翔的翅膀，还存在任何的意义吗？<br>远野稍稍把视线转向我，如此问道。<br>美凪：肯定没有任何意义……无法去往天空也无法回到大地，只能四处彷徨。<br>美凪：就像那只鸟一样……我也只能永远彷徨下去……</p></blockquote><h2 id="摘抄"><a href="#摘抄" class="headerlink" title="摘抄"></a>摘抄</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><blockquote><p>远野用温暖的目光看着小满。<br>时不时像是在确认小满是否存在一样，触碰她、抚摸她的头。<br>小满幸福地笑着。<br>多么美好的画面啊。<br>感觉这景象就算一直看也肯定看不腻。<br>而现在的我，是否也深处这景象之中呢？<br>这会不会是梦中的景象呢？<br>这令人安心的温暖让我甚至会这么想…</p></blockquote><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><blockquote><p>往人：如果离别不会感到寂寞，那相遇不就变得没有意义了吗？<br>美凪：也许吧……<br>美凪：但是……<br>往人：但是？<br>美凪：寂寞……只会成为枷锁……<br>美凪：会让你无法再迈出一步……<br>美凪：无法前进，也无法后退……只能承受着悲伤……<br>往人: ……<br>美凪：……<br>我们把所有的话语都交给风。<br>残留着潮水气息的风，吹得树叶沙沙作响。<br>这声音，让我想起差点忘记的事情。<br>只要不是永远，终会迎来别离。<br>对日常生活来说也是一样。<br>我们的生活中，始终与别离背对着背。<br>既然如此……<br>那终有一天会结束的日常……<br>和会醒来的梦，又有多大的区别呢？<br>一样的。<br>我们一直生活在梦中。<br>无论梦还是现实，都没有任何的区别。<br>所以……<br>我想知道，当梦结束之后，究竟会迎来什么。</p></blockquote><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><blockquote><p>往人：是和我一起去旅行，还是一个人去别的地方。<br>往人：又或者……回到你该回去的地方。选择权在你。<br>美凪：我来……决定。<br>往人：没错。要以远野美凪自己的意志做决定。</p></blockquote><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><blockquote><p>‘无法飞翔的翅膀，还存在任何的意义吗？’<br>不经意回想起远野的话。<br>往人：（……当然有意义了。）<br>往人：（因为它承载着往昔翱翔天际的宝贵回忆啊。）<br>往人：（…..）<br>往人：（你说对吧……小满……)</p></blockquote><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><blockquote><p>小满：在天空中……有个非常寂寞的女孩。<br>小满平静地说着。<br>声音彷佛不是我认识的那个幼小的女孩，听起来像个成熟的大人。<br>小满：那个女孩一直在做着悲伤的梦，除此之外一无所有。<br>小满：因为无法得到幸福，只能做着悲伤的梦。<br>小满：小满……就是那悲伤的梦的碎片。<br>往人：……<br>往人：就是说……<br>小满的话让我回想起来。<br>母亲从小就反复讲给我听的，那个女孩的身姿。<br>背负着悲伤翅膀的，女孩的身影。<br>小满：不对……不太一样……<br>彷佛要制止我的思考，小满摇了摇头。<br>小满：小满只是那个女孩梦中非常小的一片。<br>小满：她的背后，有一双伤痕累累的翅膀……<br>小满：那双翅膀，有着非常神奇的力量。<br>小满：无数人的经历，许许多多的回忆，凝聚在那对翅膀之上。</p></blockquote><h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><blockquote><p>小满：小满，得到了那个女孩的一片羽毛。<br>小满：因为，我有想见的人……<br>小满：又想要见面，想让她们得到幸福的人……<br>小满：想要让她们的幸福，和那个女孩的幸福联系在一起……<br>小满：小满从那个女孩那里，得到一份回忆。<br>小满：因为想要和那个人成为朋友，需要回忆。<br>小满：因为小满没有任何回忆……<br>小满：国崎往人，你知道吗？<br>往人：……什么？<br>小满：人类……没有回忆是无法活下去的。<br>小满：但尽管如此……只依靠回忆，同样无法活下去。<br>小满：梦……总有一天会醒来。<br>小满：忘记醒来的梦……无论是多么幸福的梦……也总有一天会变成悲伤。</p></blockquote><h3 id="7"><a href="#7" class="headerlink" title="7"></a>7</h3><blockquote><p>往人：真的可以把一切都洗涤干净吗？<br>美凪：……<br>往人：……对不起，请容我拒绝。<br>往人：我想带着自己所有的丑陋和污秽，继续活下去。<br>往人：好不容易活到这个年纪，我不想做出把这些岁月一笔勾销的事。</p></blockquote><h3 id="8"><a href="#8" class="headerlink" title="8"></a>8</h3><blockquote><p>往人：不管有多么幸福，也有些人是无法停留在原地的。<br>得到了什么，就必须守护什么。<br>如果从一开始就一无所有，就不会失去任何东西。</p></blockquote><h3 id="9"><a href="#9" class="headerlink" title="9"></a>9</h3><blockquote><p>我在台阶上坐了下来。<br>乌鸦横穿过橘红色的天空准备回巢。<br>从附近的肉店飘来了熟食的香味。<br>远处的马路上，跑过去几个游泳归来的小孩。<br>一幅柔和而又令人怀念的景象。<br>这是为什么呢？<br>我是不是在一点点地融入这个小镇呢？</p></blockquote><h3 id="10"><a href="#10" class="headerlink" title="10"></a>10</h3><blockquote><p>我心里明白。<br>也许我根本没信过什么天空中的女孩。<br>也许我在寻找的，正是旅行的理由本身。<br>因为没有人告诉我其他还有什么样的活法。<br>我问自己。<br>我想做什么呢？<br>我该朝哪里前进呢？<br>我不太清楚。</p></blockquote><h3 id="11"><a href="#11" class="headerlink" title="11"></a>11</h3><blockquote><p>对于我来说，旅行本就是日常。<br>不去旅行的生活，对我来说就是新的冒险。</p></blockquote><h3 id="12"><a href="#12" class="headerlink" title="12"></a>12</h3><blockquote><p>这孩子那数不尽的可爱。<br>若比作天空，便如无穷繁星。<br>若比作山林，便如葱茏草木。</p></blockquote><h3 id="13"><a href="#13" class="headerlink" title="13"></a>13</h3><blockquote><p>这个女人也不知从什么时候起，一直处于不安之中。<br>她是否也察觉到了天空所预示的悲伤？<br>或许她比那两个人更早就察觉到了。<br>因为每次和我在一起的时候，她总是会露出寂寞的表情。</p></blockquote><h3 id="14"><a href="#14" class="headerlink" title="14"></a>14</h3><blockquote><p>将她们二人联系在一起的……<br>我认为是母女之间的纽带。<br>一直陪在她身边的这个女人，原来是她的母亲。<br>回想起来，她们两个人一起经历了许多往事。<br>有时甚至难以相信她们是一对母女。<br>然而，她们确确实实是母女。<br>或者说，正因为这样，她们才能成为母女。<br>如今陪在她的身边，我明白了。<br>明白了她们两人克服过的困难。<br>而且，现在她们仍然互相陪伴在一起。<br>这便是她们是母女的铁证。</p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;感想&quot;&gt;&lt;a href=&quot;#感想&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="游戏笔记" scheme="https://luolibrary.com/categories/%E6%B8%B8%E6%88%8F%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="GalGame" scheme="https://luolibrary.com/tags/GalGame/"/>
    
  </entry>
  
  <entry>
    <title>《嫌疑人X的献身》读书笔记</title>
    <link href="https://luolibrary.com/2025/05/22/%E3%80%8A%E5%AB%8C%E7%96%91%E4%BA%BAX%E7%9A%84%E7%8C%AE%E8%BA%AB%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    <id>https://luolibrary.com/2025/05/22/%E3%80%8A%E5%AB%8C%E7%96%91%E4%BA%BAX%E7%9A%84%E7%8C%AE%E8%BA%AB%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</id>
    <published>2025-05-21T16:25:42.000Z</published>
    <updated>2025-05-21T16:26:05.536Z</updated>
    
    <content type="html"><![CDATA[<p>这应该是我第三次阅读《嫌疑人X的献身》了，本次读完这本小说，我不得不感慨东野圭吾的笔力。实际上，东野圭吾的侦探小说不仅仅只着重于侦探的部分。从剧情上来说，这是一个比较简单的故事，然而作者在最后给读者的震撼是非同一般的。每当我阅读到石神基于做加法的思路（杀一个人）来干扰警方的视野时候，我就在感慨石神的布局是如此的聪明。因为正常的思维都是需要做减法来干扰</p><p>石神主要采取的以下的手段（基于上帝视角）：</p><ul><li>脱下了富㭴慎二的衣服。（这也是作者的一个烟雾弹，这是我在读的时候以为是要隐藏线索，但实际的目的是想让警方认为石神杀的流浪汉就是富㭴慎二）</li><li>用杀死富㭴慎二同样的方式杀死了流浪汉，在自己家里留下证据，方便顶罪。</li><li>偷了一个新的自行车，让警方能够快速定位，从而确定作案时间，进而证明花冈靖子的不在场证明。</li><li>为了让警方认为石神杀死的流浪汉就是富㭴慎二，故意在偷的自行车上面留下了富㭴慎二的指纹。让警方误以为凶杀要烧掉死者的衣服，毁灭证据。但实际上是故意地引导警方认为死者就是富㭴慎二。</li><li>故意地给花冈靖子模糊的不在场证明，因为完美的不在场证明本身就是破绽。</li></ul><p>由此可见，石神是一个相当聪明的人，而且具有极高的执行力。能够正确的处理境况，他认为到了做减法是不可能瞒过警察的，于是选择做加法来处理。不得不感叹，极度地理性啊。然而，我的这个读书笔记最想讲的就是我对石神的感受。</p><h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>石神是孤独的，或者说我能感受到他的孤独。无论是作为大学生的他，还是在大学里面做教授的他，还是在高中学校里面当数学老师的他，一路都纯粹地做他自己最想做的事情：研究数学。在作品中，汤川给石神带来了一个有趣的数学问题，石神沉浸在自己的世界里面研究。然而，这样纯粹的他，并没有得到认可。无论是作为大学教授的他，还是作为在高中学校里面当数学老师的他。其实，我有时候就在思考，我们是真的悲哀。明明生在一个意义都是被构建出来的世界中，却仍然需要这个社会的认可存活（纵使石神认为自己并不需要任何人的肯定，但我觉得这是矛盾的，这是我们的社会属性所强加给我们的，任何人都难以避免，不然石神为什么会选择自杀呢？）。正如同他自杀的理由：</p><blockquote><p>他已毫无留恋。没有理由寻死，也没有理由活着，如此而已。</p></blockquote><p>石神决定自杀的时候，花冈靖子给他的世界带来了光明。很多作品的解析把这个称为爱情，其实我觉得这就是误解。花冈靖子在此刻成为了石神的精神支柱和信仰。石神并不是因为想要真正得到她而选择帮助了她。当石神看见花冈靖子和工藤邦明之间的感情关系的时候，作者放了一个烟雾弹，就是石神写下了威胁信寄给花冈靖子。我想肯定作为读者，当时想的是石神是妒忌了，但实际上这也是石神的一环。正如汤川所讲述的</p><blockquote><p>你们做的，只是按照他的证明方法走。你们该做的，是探寻有没有别的答案。除了他提供的答案之外别无可能——唯有证明到这个地步，才能断言，那个答案是唯一的答案！</p></blockquote><p>然而，花冈靖子的自首把石神的所有计划都毁了。当然，从社会正确的价值观出发，花冈靖子是应该自首的，因为她杀了人理应受到法律的惩罚。她认为她应该和石神先生一起承担这份罪孽，殊不知她完全不了解石神。当时她不了解石神也是理所当然的，花冈靖子就是一个普通人。我不想去批判花冈靖子的行为，我只想说她的所作所为彻底地抹杀了石神的意义以及存在。其实这也说明了花冈靖子就是不爱石神，她自首的目的并不是为了石神，而是为了让自己心安。</p><p>汤川认为石神爱花冈靖子，我认为这点没什么，石神肯定是对花冈靖子有好感的。但是汤川为什么要对花冈靖子说出事情的真相呢？从作品的得到的信息是汤川希望花冈靖子知道石神对她的付出，以及对她的爱有多深。我其实理解汤川的做法，汤川也是基于自己的价值观出发来选择自己的行为的（其实，我认为这一部分是剧情杀，如果让汤川选择隐瞒真相的话，作品就不好写了）。</p><p>最终，石神所作的一切都化为了泡影。石神以为他的计划已经天衣无缝，但他唯独的失误就是忽略了人性，忽略了作为普通人的花冈靖子是难以承受这种罪恶感生活下去的。这种独一无二的孤寂感，是东野圭吾给我带来的震撼。侦探小说只是这部作品的表罢了，里仍然是人孤独的本质。</p><p>让我用小说的最后作为我感想的结尾吧。</p><blockquote><p>石神继续嘶吼，草薙觉得他仿佛正呕出灵魂。</p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;这应该是我第三次阅读《嫌疑人X的献身》了，本次读完这本小说，我不得不感慨东野圭吾的笔力。实际上，东野圭吾的侦探小说不仅仅只着重于侦探的部分。从剧情上来说，这是一个比较简单的故事，然而作者在最后给读者的震撼是非同一般的。每当我阅读到石神基于做加法的思路（杀一个人）来干扰警方的</summary>
        
      
    
    
    
    <category term="读书笔记" scheme="https://luolibrary.com/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="小说" scheme="https://luolibrary.com/tags/%E5%B0%8F%E8%AF%B4/"/>
    
  </entry>
  
  <entry>
    <title>《进击的巨人》——自由之翼</title>
    <link href="https://luolibrary.com/2025/04/15/%E3%80%8A%E8%BF%9B%E5%87%BB%E7%9A%84%E5%B7%A8%E4%BA%BA%E3%80%8B%E2%80%94%E2%80%94%E8%87%AA%E7%94%B1%E4%B9%8B%E7%BF%BC/"/>
    <id>https://luolibrary.com/2025/04/15/%E3%80%8A%E8%BF%9B%E5%87%BB%E7%9A%84%E5%B7%A8%E4%BA%BA%E3%80%8B%E2%80%94%E2%80%94%E8%87%AA%E7%94%B1%E4%B9%8B%E7%BF%BC/</id>
    <published>2025-04-15T15:12:10.000Z</published>
    <updated>2025-04-15T15:13:04.676Z</updated>
    
    <content type="html"><![CDATA[<p>前一段时间，抽空把《进击的巨人》从头到尾看了一遍。在此处，我无意去总结整部动漫的剧情。我想表达的更多的是我的一些感想。</p><h2 id="剧情评价"><a href="#剧情评价" class="headerlink" title="剧情评价"></a>剧情评价</h2><p>其实，我并不太喜欢《进击的巨人》的叙事手法。谏山创很擅长利用信息差制造悬念，并通过紧凑的中篇故事快速调动观看者的情绪。在每个小的中篇章中，在观看动漫的过程中，至少我的情绪是一直被调动的。其次，由于我们缺少信息，在马莱篇之前，我们都认为人类的敌人是巨人。我们的视角就如同作品中的角色视角一致，我们得消灭巨人，为了人类的自由。</p><p>到了马莱篇，许多真相逐渐开始浮出水面。然而，我并不觉得这种伏笔有什么值得称赞的。谏山创在马莱篇之前几乎没有对马莱这个国家进行过描述，针对马莱的伏笔仅仅是来自于莱纳的一些话语。</p><blockquote><p>回到无法回去的故乡，我的心愿仅此而已。</p></blockquote><p>然而，从观众的视角来看，我们只会认为莱纳是因为墙壁被破坏了，无法回到自己的故乡（艾伦肯定也是这么想的）。其实，作品使用伏笔是一个极其正常的做法，但是谏山创利用信息差控制观众的情绪。正如我们也和在墙内的艾尔迪亚人一样，我作为一个观众也是希望能够消灭巨人。但是到了马莱篇，我们都知道了实际上在马莱的艾尔迪亚人本身也是受到了马莱的压迫，在长期的洗脑教育下，马莱的艾尔迪亚人认为墙内的艾尔迪亚人是恶魔。在这一刻，这部作品实际上就已经发生了巨大的转变，从“我们得消灭人类的天敌巨人”变成了“人类与人类之间的斗争”。</p><p>实际上，这是一个很好的主题。但是，我其实并不满意谏山创的叙事方式，因为我觉得谏山创应该把整个世界观透明地展现给观众来描述这个故事。也就是直接开篇介绍马莱派莱纳等人来的目的，直接揭露墙外是存在其他的文明世界的。但是我认为谏山创没有这个水品。正是因为我们看到了调查兵团因为好奇心和追寻自由而努力地开辟墙外的世界，我们才能与作品中的角色共鸣。如果我们作为观众，一开始就知道真相呢？我们的角度是不是会不一样呢？其实，这才是考验水平的写法。实际上，网上有许多人批评谏山创的虚无主义，我倒是觉得谏山创根本不是从虚无主义的角度来描写这个作品的。反而，他本质是在玩弄观众的情绪。如果谏山创能从一开始就告诉观众真相，我才能够认同这部作品是基于虚无主义的哲学观念去描写的，我认为这其实是谏山创对观众的嘲讽。因为我们观众其实也是在墙壁里面的人，在由被谏山创构建出的这个墙壁中的人。</p><p>从马莱篇开始，谏山创已经无法使用原有的叙事手法了。这导致了谏山创难以利用信息不对称来调动观众的情绪。同时，从马莱篇开始，谏山创引入了人与人之间的斗争，拔高了作品的立意。此时，谏山创的笔力就无法驾驭住作品了。在马莱篇之间，谏山创尚且能够用二元论的方式推动剧情的发展。显然，面对势力之间的复杂矛盾，谏山创的笔力处理地一塌糊涂：</p><ol><li>由于艾伦是进击的巨人，能够和继承者进行交互，受到<strong>来自未来</strong>的始祖巨人的力量的影响。这就是这部作品超级拉胯的地方，并不是其基于宿命论的哲学观点的问题。而是这就是在忽悠观众，强行地将剧情之间的关系连接起来。那么实际上我们可以说艾伦的一切行动都是基于始祖巨人的。不论其对马莱发动袭击还是发动地鸣。在我的理解里面，艾伦的塑造彻底拉胯，因为在马莱篇之间，我们可以认为艾伦是基于其意志追寻自由，然而谏山创却直接把观众当成了一个笑话。艾伦在我看来只不过是一个傀儡了。</li><li>始祖尤弥尔的人物塑造问题。我其实并不反感尤弥尔本身的人物塑造，但是问题在于谏山创对于这个人物的塑造没有逻辑，我们就当始祖尤弥尔当时没有转过弯来，被“爱情”蒙蔽了双眼。在这么多年的时间里，始祖尤弥尔一直被她过去的爱情和自身的奴隶身份束缚，然后被艾伦几句话就劝动了。我求求了，一个2000多年都生活在束缚之中的人，就靠几句嘴遁就被唤醒了自我意识吗？特别是尤弥尔最后看到三笠亲手杀死艾伦，从爱情的束缚中解脱，使巨人之力从世上消失。我觉得这就是纯粹在扯淡了。倒不如说谏山创根本不知道怎么收尾了，只能这样搞，导致了人物为剧情服务。</li></ol><p>当然，你不得不承认谏山创这样的方式，使作品在商业上成功了。</p><h2 id="虚无主义"><a href="#虚无主义" class="headerlink" title="虚无主义"></a>虚无主义</h2><p>为什么我单独用一节讲这个问题呢，是因为网上有很多人认为最后谏山创的处理是虚无主义的体现，但要我说谏山创并没有实力写出虚无主义的作品。在传统虚无主义文学作品中，全知叙事是最常见的叙事手法。例如，加缪的《局外人》虽然采用第一人称叙事，但读者能够看到梅尔索行为的荒谬性；萨特的《恶心》让读者理解洛根丁的存在危机；卡夫卡的《变形记》则让读者从一开始就知道格里高尔的处境。然而《进击的巨人》选择让观众与角色共同经历认知的转变过程，而非从一开始就拥有完整的世界观认知。</p><p>这导致了一个严重的问题，在我的理解里，谏山创仅仅是通过这种方式来渲染情绪。如果真的想要展现虚无主义，更应该展现<strong>无意义的战斗</strong>。如果谏山创采用上帝视角，从一开始就向观众展示墙内艾尔迪亚人和马莱人各自的处境和思想，让读者看到两方都被各自的意识形态和历史记忆所束缚，都认为自己在为正义而战，那么作品的虚无主义主题可能会更加鲜明和深刻：</p><ol><li>墙内人为“自由”而战的徒劳。</li><li>每个角色都被自身视角所局限。</li></ol><p>真正展示虚无主义，最有效的方式往往是通过上帝视角展示不同阵营无意义的战斗。这种叙事策略能够让观众超越单一视角的局限，直接感受到冲突的荒谬性和徒劳性。同时，也能让我们思考存在主义，纵使这个世界是荒诞的，仍然有一群人在为自己的存在意义而战斗，例如调查兵团。</p><h2 id="调查兵团"><a href="#调查兵团" class="headerlink" title="调查兵团"></a>调查兵团</h2><p>反而，调查兵团是整部作品中塑造的最好的部分。无论是马莱篇前，调查兵团为了追寻自由或者满足自己的好奇心选择去开拓墙外的世界还是在马莱篇后调查兵团坚持自己的信念都令人无比动容。在我的理解里，调查兵团代表了人类最优秀的品质，不满足于成为猪猡，遵循自己的好奇心追寻自由，真正能够被称为自由之翼。然而，自由的代价是巨大的，调查兵团众多人的牺牲，为了自己的信念献出了心脏。</p><p>实际上，这也是我觉得谏山创笔力不行的地方，如果谏山创在一开始就让观众看了上帝视角，纵使观众在前期会觉得调查兵团被隐瞒在欺骗之中，观众更会被调查兵团展现的品质所打动。哪怕是面对无意义，调查兵团也坚持自己的信念。实际上，这本身就是人们对于虚无的反抗，无论是选择生活在虚无，荒诞或者存在中，作为观众更想看到的是作品中的人类的反思，挣扎，最后坚定不移的坚持自己的信念。这才是真正的勇气。</p><p>泽野给调查兵团写的两首歌“The Dogs”和“Barricades”或许完美无缺地表达了调查兵团的品质。</p><ul><li>The Dogs<blockquote><p>Do you believe that we can just kill them all?<br>Do you believe that we can conquer this?<br>Can’t delete all the mess that I have seen<br>Fall in the fire, but these burns will heal you<br>Coming down to show you what to do<br>How to die with honor, dignity<br>We should delete all the mess out from our sight<br>What is truth is for me and you</p></blockquote></li><li>Barricades<blockquote><p>Wouldn’t it be nice to take a walk on some pure white sand<br>Gaze at the horizon<br>Without living in fear?<br>Wouldn’t it be sweet to watch the sun curve down meets the waves?<br>And taste the ocean spray<br>And realize we’d been living as slaves</p></blockquote></li></ul><p>为调查兵团献出心脏。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;前一段时间，抽空把《进击的巨人》从头到尾看了一遍。在此处，我无意去总结整部动漫的剧情。我想表达的更多的是我的一些感想。&lt;/p&gt;
&lt;h2 id=&quot;剧情评价&quot;&gt;&lt;a href=&quot;#剧情评价&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="动漫笔记" scheme="https://luolibrary.com/categories/%E5%8A%A8%E6%BC%AB%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="动漫" scheme="https://luolibrary.com/tags/%E5%8A%A8%E6%BC%AB/"/>
    
  </entry>
  
  <entry>
    <title>2024年终总结</title>
    <link href="https://luolibrary.com/2024/12/26/2024%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>https://luolibrary.com/2024/12/26/2024%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2024-12-25T16:34:35.000Z</published>
    <updated>2024-12-25T16:34:53.403Z</updated>
    
    <content type="html"><![CDATA[<p>眨眼的瞬间，2024年就要过去了。记忆中突然飘来我曾在西电的网安大楼写下了2023年终总结的碎片。如今的我坐在上海的小小出租屋里，不禁回望四周，感慨时间的无情流逝。在这淡淡的哀愁中，我又回想起《将进酒》中的名句。</p><blockquote><p>君不见黄河之水天上来，奔流到海不复回。<br>君不见高堂明镜悲白发，朝如青丝暮成雪。</p></blockquote><p>此时此刻，我的手停留在键盘之上，不知道该如何去表达自己的情感。各种复杂的情感纠结于我心中，无论如何，我只是想刻下自己的存在。</p><h2 id="走向开源世界：Git"><a href="#走向开源世界：Git" class="headerlink" title="走向开源世界：Git"></a>走向开源世界：Git</h2><p>依稀记得2023年的时候，我一个人前往了上海实习，在那个小小的出租屋里，我总会觉得寂寞。突然想起自己在2023年的年终总结刻下的话语：</p><blockquote><p>上班的体验是很好的，然而晚上一个人待在上海小小的出租屋里面，感受到的确实实在的寂寞。突然急切地希望自己身边能有一个人陪伴，然而我却厌恶自己的想法，如果是因为寂寞就去靠近一个人，对她来说这是一个不公平的事情。</p></blockquote><p><strong>必须给自己找点事情做，不想在2024年重蹈覆辙。即便是一个人生活，也想让自己的每天变得精彩，想让自己鲜明地体会到活着的感觉</strong>。怀揣着上面的想法，我决定给自己找一些有意义的事情去做。借着自己最后的学生生涯，我选择参加了谷歌开源之夏（GSoC），荣幸地被Git开源项目选上，为Git的引用实现一致性检查（<a href="https://summerofcode.withgoogle.com/archive/2024/projects/ukm4PTEF">Implement consistency check for refs</a>）。</p><p>在2024年5月到2024年8月期间，经历了许多痛苦（从版本1迭代到了版本16），我的代码终于提交到了Git仓库里面。看到自己能够为这么一个基础的软件做出贡献，自己实现的功能能够被整个世界的程序员使用，我由衷地为自己感到自豪。我十分感谢指导我的两位导师<a href="https://github.com/pks-t">Patrick</a>和<a href="https://github.com/KarthikNayak">Karthik</a>，给予了我大量的指导和帮助。我对Patrick和Karthik在项目结束对我说的一句话印象特别深刻：</p><blockquote><p>Take on the role of the subject matter expert. This is rather hard initially, but at the end of the project you already had quite a lot of knowledge around how the whole infrastructure works. Carefully answering questions, explaining why certain proposals are not feasible or why your tradeoffs are better demonstrates that you know what you are doing. It’s important to find the right balance between taking feedback from others and confidently saying why your version makes sense. (扮演主题专家的角色。这一开始可能会有些困难，但在项目结束时，你已经对整个架构的运作方式积累了相当多的了解。耐心回答问题，解释为什么某些提议不可行，或者为什么你的权衡更优，这些都能展示你对自己的工作了然于心。找到在接受他人反馈和自信地说明自己方案更合理之间的平衡点非常重要。)</p></blockquote><p>在谷歌开源之夏的旅程中除了收获了代码能力的进步，我觉得最大的收获是加强了人与人之间的联系，我与我的两位导师Patrick和Karthik建立了良好的关系。我原先很少用英文和别人交谈，最开始的第一次和Patrick视频会议，我相当的紧张。同时，我觉得和git社区建立了良好的关系，通过一个开源项目能够让生命中本不会产生交集的大家联系起来，体会到了开源的魅力。</p><p>尽管谷歌开源之下在8月底就结束了，我仍然留在Git社区继续完善我该做的工作，并开始审核别人的代码来了解Git其他部分的功能是如何运作的。今年的我提交了20个commit:</p><ol><li><a href="https://github.com/git/git/commit/b3d175409d9bfe005515ffe361e959fb9965111c">Ref consistency check infrastructure setup</a></li><li><a href="https://github.com/git/git/commit/57e81b59f35198afedae18e8363dbffdc96c481d">Ref content consistency check for file backend</a></li></ol><h2 id="研究生毕业"><a href="#研究生毕业" class="headerlink" title="研究生毕业"></a>研究生毕业</h2><p>伴随着6月底的到来，我也从西电毕业了，人生迈入一个新的阶段。比起本科毕业的时候，或许是因为习惯了离别的原因，又或许是期待自己在上海的新生活的原因，我似乎没有那么伤感了。然而，我的内心仍然悸动，看着实验室的工位变得如此干净，总有种自己的存在被抹去的感觉。回想自己在西电的三年，不知道自己是否变得更加温柔了，也不知道自己是否变得更加勇敢了，更不知道自己是否前进了。诸多回忆突然涌入脑海，让我不知所措。</p><p>然而，我深刻地意识到我即将从集体生活转变为个人生活。再也无法和雨晴一起晚上10点后在实验室打玩游戏，一起回寝室了。再也无法简单地在实验室和兄弟们说一句，今天要不要去小码头搓一顿改善一下伙食。我突然觉得伤感，让我想起一句歌词：</p><blockquote><p>倘若从这场梦醒来，我的孤独该付诸何处。</p></blockquote><h2 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h2><p>比起2023在上海实习的我，我更习惯一个人的生活了。我觉得是因为我在2023年已经体会了孤独一人的感觉，提前做了一些准备。至少意识到，得利用好自己的时间，如果任凭时间流逝，无所事事就会觉得空虚，。然而，<strong>这样想是不是会太寂寞呢</strong>？我还是不太想妥协，也不想对自己说谎。</p><p>我不知道自己是否做到了怀揣着生命力和想象力去生活，今年从正式工作开始，重拾了阅读的习惯，我真的好久没有看过书了，然而我始终觉得看书是一个很美好的事情，总能让我静下心来。我原先很不会去享受生活，和同事在每天中午溜圈的时候，我才意识到自己的局限性，其实我也是容易待在舒适圈里面的。于是努力去尝试了更多新鲜的事物，自己周末骑自行车到处去逛，偶尔去咖啡馆看书。但是还是很难，一个人的动力是真的太小了。</p><h2 id="影响力"><a href="#影响力" class="headerlink" title="影响力"></a>影响力</h2><p>说影响力是不是太膨胀呢？（逃</p><h3 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h3><p>其实今年最令我开心的时候，莫过于我的博客有7000多的浏览量，一想到我曾经写下的文字或多或少影响到了在这个世界上的某一个陌生人，给他带来了某些启发，又或是鼓舞了他。我由衷地觉得自己的坚持是有意义的。</p><p><img src="https://s2.loli.net/2024/12/26/DaG3KmguAoYftdb.png" alt="博客数据"></p><h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><p>完成了谷歌开源之夏后，Git社区对我进行了一次<a href="https://git.github.io/rev_news/2024/09/30/edition-115/">采访</a>，我其实对这次采访很是惊讶的，毕竟我觉得我只是完成了一份微小的工作，十分感谢社区的友好。</p><p>可能最开心的还是自己实现的功能上了所谓的<a href="https://s2.loli.net/2024/12/26/DaG3KmguAoYftdb.png">头条</a>，逐渐在这个世界里面刻下自己一些微不足道的存在。</p><p><img src="https://s2.loli.net/2024/12/26/Oc4vSMYy32rXp5A.png" alt="git news"></p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>耳边传来熟悉的音乐，在这白色相簿的季节，听着“Powder Snow”。</p><blockquote><p>点点细雪轻轻地从天而降<br>接在手心时，我不由得难过<br>停下脚步的你，望着哪个地方呢<br>仰望天空时，是否想起了我们的曾经</p></blockquote><p>在这无形的时间中，简单刻下自己的存在。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;眨眼的瞬间，2024年就要过去了。记忆中突然飘来我曾在西电的网安大楼写下了2023年终总结的碎片。如今的我坐在上海的小小出租屋里，不禁回望四周，感慨时间的无情流逝。在这淡淡的哀愁中，我又回想起《将进酒》中的名句。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;君不见黄河之水天上来</summary>
        
      
    
    
    
    <category term="随笔" scheme="https://luolibrary.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
  </entry>
  
  <entry>
    <title>星之终途</title>
    <link href="https://luolibrary.com/2024/08/27/%E6%98%9F%E4%B9%8B%E7%BB%88%E9%80%94/"/>
    <id>https://luolibrary.com/2024/08/27/%E6%98%9F%E4%B9%8B%E7%BB%88%E9%80%94/</id>
    <published>2024-08-26T16:06:02.000Z</published>
    <updated>2024-08-26T16:39:54.088Z</updated>
    
    <content type="html"><![CDATA[<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>这部作品我是冲着田中先生的名气购入的，其实我更多的是想看田中先生想在这部作品表达什么观点。本作是一个典型的公路片剧情，不愧为二次元的死亡搁浅。田中以极其紧凑的方式走完了剧情，我打完本部作品仅用了5个小时，还包括了我摘抄的时间。</p><p>我认为作品的核心一如既往地贯穿了田中的理念。我个人认为田中并不是想去探讨所谓的人性，而是一如既往地收束到爱与希望。先抛开对于女主的塑造，片中最大的冲突在于科学家希望通过菲莉亚来拯救人类，然而裘德并不认为人类所需要拯救。我认为这就是田中的核心观点。我也认为人类不需要拯救，人类会一直丑陋地活下去。</p><p>里面有个核心的对于女主的塑造在于“成为人类”。我认为田中的塑造的最好一点是，女主在成为人类的过程中非常地自然，我在里面看到了自己的成长。我特别喜欢女主的这一句话：</p><blockquote><p>菲莉亚：这个世界，难道被设计成了一旦想要帮助他人就会绝对失败的样子吗？</p></blockquote><p>我相信，我们都曾有过这个疑问。这种自嘲的发言让我颇有既视感。</p><p>说实话，本作有很多背景也没有交待清楚，比如说两个阵营AI的斗争，让我又想起了rewrite里面盖亚和守护者的对立。可惜，本作仅仅是短片，并没有继续深入。</p><p>总的来说，体验很好，如同一场电影一般。</p><h2 id="摘抄"><a href="#摘抄" class="headerlink" title="摘抄"></a>摘抄</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><blockquote><p>裘德：活人凑在一起就是这么臭。<br>菲莉亚：如果我也变臭，我就能成为人了吗？<br>裘德：不会的。</p></blockquote><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><blockquote><p>……我不懂这种感情。<br>从未想过去理解，以后也没打算理解。<br>想理解这种感情就要拥有家庭。<br>也就是会扎下根。</p></blockquote><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><blockquote><p>那时，她也从头到尾没有大喊大叫过。<br>仅仅是用她锐利冷静的目光盯着我，像是在劝说我。<br>态度的言下之意仿佛是我做错了什么。<br>毫无疑问在她心中，残忍就是邪恶。<br>也认为不杀生就是正义。<br>甚至为了这份正义，即使自己挨饿也在所不惜。<br>她一定觉得这是美好的。</p></blockquote><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><blockquote><p>我与她共处的回忆理应数不胜数。<br>然而，这些回忆却无法按照时间顺序衔接起来。<br>事情发生的向后顺序已经变得模糊不清。<br>……这些回忆已经被时间所冲淡。<br>几年前还记得的事情，现在印象已然十分稀薄。<br>留下了深刻印象的，反倒净是些争论争吵。<br>在我看来，她的主张完全是不可理喻的。<br>她不愿意杀死鹿或者兔子，但也并非素质主义者。<br>肉干她一样爱吃。<br>菲莉亚也是如此。<br>保存用的肉类就可以毫无顾忌地吃下去。<br>要我说的话，这只不过是自欺欺人。</p></blockquote><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><blockquote><p>有些人对猎杀哺乳动物有抵触情绪，却对杀鱼或昆虫之类的并不在意。<br>……对我来说是难以理解的想法，但确实是存在的。</p></blockquote><h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><blockquote><p>她是一个喜爱美好事物的女人。<br>总是憧憬着人类的尊严与善良，还有不再残酷的世界。<br>也会拒绝拿枪自卫。<br>也不喜欢我携带武装。<br>厌恶枪支。</p></blockquote><h3 id="7"><a href="#7" class="headerlink" title="7"></a>7</h3><blockquote><p>裘德：那毕竟人类就是最可怕的。<br>一提到这个话题，菲莉亚的表情就复杂了起来。</p></blockquote><h3 id="8"><a href="#8" class="headerlink" title="8"></a>8</h3><blockquote><p>菲莉亚：从一出生就知道所有事情的话，就不太像人类了吧。</p></blockquote><h3 id="9"><a href="#9" class="headerlink" title="9"></a>9</h3><blockquote><p>裘德：……你觉得为什么父母会为了孩子舍弃生命？<br>菲莉亚：因为人类很伟大。<br>裘德：不对，有确切的理由。<br>菲莉亚：是什么？<br>裘德：本能。<br>菲莉亚：……？<br>裘德：为什么父母会重视孩子胜过生命？<br>菲莉亚：因为爱他们？<br>裘德：为什么会爱？<br>菲莉亚：因为是自己的孩子？<br>裘德：所以从孩子出生的那一刻起，就爱着他们。<br>菲莉亚：……是吧。<br>裘德：那会是真正的爱吗？<br>菲莉亚：什么意思？<br>裘德：还不知道这个婴儿会是怎样的人，只是因为是自己的孩子就会爱他。<br>裘德：通常情况下，一个人爱上另一个人是在了解对方以后。<br>裘德：但是对孩子的爱却并非如此，而且是无条件且自动的。为什么呢。<br>菲莉亚：……<br>裘德：因为基因在人的本能里刻下了要保护后代的信息。<br>菲莉亚：哎？<br>裘德：我不觉得那必然是一种崇高的行为，单纯只是本能。<br>菲莉亚：那么，父母为了孩子舍弃生命也……<br>裘德：是因为基因命令他们这么做。<br>裘德：不好意思好像是我在破坏你的幻想，但如果你过于理想化人类，总有一天会伤到你自己的。<br>裘德：无法好好爱孩子的父母也是大有人在的。<br>菲莉亚：……但是至少，会有一点真正的爱，对吧？<br>裘德：当然也有。一起生活多年后，不是本能的爱也会掺入进来。如果是那种爱意，我也不是不能理解。<br>菲莉亚：……那就足够了。哪怕只有一点点，都很伟大。<br>菲莉亚：我也是有本能的吗？<br>裘德：你那想成为人类的愿望，正是类似本能的东西。<br>菲莉亚：哦哦。<br>裘德：你为什么想成为人类？<br>菲莉亚：因为想成为。<br>裘德：还是在被出厂设置牵着走啊。<br>裘德：记住，让本能伴随上思考，哪怕是事后想的。那才是人类。<br>菲莉亚：……好难。</p></blockquote><h3 id="10"><a href="#10" class="headerlink" title="10"></a>10</h3><blockquote><p>菲莉亚：这个世界，难道被设计成了一旦想要帮助他人就会绝对失败的样子吗？<br>裘德：哈哈哈。<br>菲莉亚：为什么要笑呢？<br>裘德：没什么，只是觉得你说的很对。</p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;感想&quot;&gt;&lt;a href=&quot;#感想&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="游戏笔记" scheme="https://luolibrary.com/categories/%E6%B8%B8%E6%88%8F%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="GalGame" scheme="https://luolibrary.com/tags/GalGame/"/>
    
  </entry>
  
  <entry>
    <title>GSoC Final Report</title>
    <link href="https://luolibrary.com/2024/08/25/GSoC-Final-Report/"/>
    <id>https://luolibrary.com/2024/08/25/GSoC-Final-Report/</id>
    <published>2024-08-25T14:32:06.000Z</published>
    <updated>2024-08-25T14:37:08.320Z</updated>
    
    <content type="html"><![CDATA[<p>Suddenly, I recalled myself writing the proposal back then, and I couldn’t help but feel a bit wistful. Every time it ends, there’s always an unintentional sense of sadness. After three months, my GSoC project has also come to an end.</p><h2 id="The-Motivation-of-The-Project"><a href="#The-Motivation-of-The-Project" class="headerlink" title="The Motivation of The Project"></a>The Motivation of The Project</h2><p>The <code>git-fsck(1)</code> command is mainly used to check the consistency of the object database which misses check for the ref database. Although <code>git-fsck(1)</code> implicitly checks some properties of the ref database when checking connectivity, these checks aren’t sufficient to ensure that all refs are properly consistent like <a href="https://lore.kernel.org/git/6cfee0e4-3285-4f18-91ff-d097da9de737@rd10.de/">report</a> shows.</p><p>The goal of this small GSoC project is to establish the infrastructure for the ref consistency check, enabling developers to easily add checks for both the files backend and the reftable backend. For more detailed information, please refer to the <a href="https://docs.google.com/document/d/1pWnnyykGmJIN-wyosZ3PtueFfs_BRdvJq-cwroRorBI/">proposal</a>.</p><h2 id="The-Patches"><a href="#The-Patches" class="headerlink" title="The Patches"></a>The Patches</h2><p>I began my work by implementing the infrastructure. However, during the review process, the design underwent significant changes. My main focus was on the following tasks:</p><ol><li>Refactoring the fsck error messages to make them generic, allowing both the object database and the ref database to use the same fsck error message interfaces to avoid repetition.</li><li>Utilizing the existing polymorphism provided by the <code>ref_storage_be</code> structure. For every backend, it needs to provide its own function pointer which would bring a lot of flexibility.</li><li>Designing extensible interfaces for checking ref consistency in the files backend.</li><li>Adding a ref name consistency check for the files backend.</li></ol><p>The ultimate merged patch links are given below:</p><ul><li><a href="https://lore.kernel.org/git/ZrSq3Z8tYrGwBOqC@ArchLinux/">[GSoC][PATCH v16 1&#x2F;9] fsck: rename “skiplist” to “skip_oids”</a>.</li><li><a href="https://lore.kernel.org/git/ZrSq6XV8hKRZMrnt@ArchLinux/">[GSoC][PATCH v16 2&#x2F;9] fsck: rename objects-related fsck error functions</a></li><li><a href="https://lore.kernel.org/git/ZrSrdwOCWrXpMYIA@ArchLinux/">[GSoC][PATCH v16 3&#x2F;9] fsck: make “fsck_error” callback generic</a></li><li><a href="https://lore.kernel.org/git/ZrSrgRGwI_jldprn@ArchLinux/">[GSoC][PATCH v16 4&#x2F;9] fsck: add a unified interface for reporting fsck messages</a></li><li><a href="https://lore.kernel.org/git/ZrSrjO2ltoJuppKA@ArchLinux/">[GSoC][PATCH v16 5&#x2F;9] fsck: add refs report function</a></li><li><a href="https://lore.kernel.org/git/ZrSrlU8TesYsTb2C@ArchLinux/">[GSoC][PATCH v16 6&#x2F;9] refs: set up ref consistency check infrastructure</a></li><li><a href="https://lore.kernel.org/git/ZrSroE8vLlZCK2jp@ArchLinux/">[GSoC][PATCH v16 7&#x2F;9] builtin&#x2F;refs: add verify subcommand</a></li><li><a href="https://lore.kernel.org/git/ZrSsk27zqOqSXTpH@ArchLinux/">[GSoC][PATCH v16 8&#x2F;9] files-backend: add unified interface for refs scanning</a></li><li><a href="https://lore.kernel.org/git/ZrSsngBqfyTPDg7g@ArchLinux/">[GSoC][PATCH v16 9&#x2F;9] fsck: add ref name check for files backend</a></li></ul><p>This series has finally been merged into the <a href="https://github.com/git/git/commit/b3d175409d9bfe005515ffe361e959fb9965111c">master</a> branch.</p><p>After establishing the infrastructure, I continue to implement additional checks for the files backend, as shown in the following patch links:</p><ul><li><a href="https://lore.kernel.org/git/ZsIM0L72bei9Fudt@ArchLinux/">[PATCH v1 1&#x2F;4] fsck: introduce “FSCK_REF_REPORT_DEFAULT” macro</a></li><li><a href="https://lore.kernel.org/git/ZsIM2DRDbJsvNjAM@ArchLinux/">[PATCH v1 2&#x2F;4] ref: add regular ref content check for files backend</a></li><li><a href="https://lore.kernel.org/git/ZsIM4OZWfylcP5Ix@ArchLinux/">[PATCH v1 3&#x2F;4] ref: add symbolic ref content check for files backend</a></li><li><a href="https://lore.kernel.org/git/ZsIM6JZ7miA3j09j@ArchLinux/">[PATCH v1 4&#x2F;4] ref: add symlink ref consistency check for files backend</a></li></ul><p>However, this series is still under review, and I plan to continue following up after GSoC.</p><h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><h3 id="Design-Challenge"><a href="#Design-Challenge" class="headerlink" title="Design Challenge"></a>Design Challenge</h3><p>Implementation is much more complex than refactoring. One of my intuitive feelings is that when designing something myself, I need to consider many factors. However, during the implementation process, I made many mistakes, mainly in two areas:</p><ol><li>Over-engineering: I was always concerned about the extensibility of the implementation, worried that poor design would require future refactoring. However, I didn’t realize that this could introduce noise into the code. We should focus solely on the features we need right now.</li><li>Inability to balance between building something that can be easily extended in the future and something that is specific to the task at hand.</li></ol><p>Here are the challenges I encountered during the implementation process:</p><h4 id="Whether-We-Need-To-Refactor-“fsck-options”"><a href="#Whether-We-Need-To-Refactor-“fsck-options”" class="headerlink" title="Whether We Need To Refactor “fsck_options”"></a>Whether We Need To Refactor “fsck_options”</h4><p>There are many fields in fsck_options that are specific to the object database. My first mistake was trying to make <code>fsck_options</code> contain the general options and sub-structures, which is what I attempted in the previous patch.</p><blockquote><p>The git-fsck(1) focuses on object database consistency check. It relies on the “fsck_options” to interact with fsck error levels. However “fsck_options” aims at checking the object database which contains a lot of fields only related to object database.</p><p>In order to add ref operations, create a new struct named “fsck_refs_options” and a new struct named “fsck_objs_options”. Remove object-related fields from “fsck_options” to “fsck_objs_options”. Change the “fsck_options” with three parts of members:</p><ol><li>The “fsck_refs_options”.</li><li>The “fsck_objs_options”.</li><li>The common settings both for refs and objects. Because we leave common settings in “fsck_options”. The setup process could be fully reused without any code changing.</li></ol></blockquote><p>While this approach may seem natural, it introduced a lot of complexity because there is a significant amount of existing code that accepts <code>struct fsck_options *</code> as a parameter. As a result, we had to deal with a lot of code that was not directly related to our main goal. In the final implementation, I simply added a <code>verbose</code> field to the <code>fsck_options</code>.</p><p>Junio gave me a wonderful suggestion:</p><blockquote><p>Just like premature optimization is bad, premature factoring and over-modularization is bad.</p></blockquote><h4 id="How-to-Reuse-“report”-Function"><a href="#How-to-Reuse-“report”-Function" class="headerlink" title="How to Reuse “report” Function"></a>How to Reuse “report” Function</h4><p>To adapt to the existing fsck error levels, my initial approach was to create a new <code>fsck_report_ref</code> function that was separate from the object report function <code>report</code>. However, Patrick, Karthik, and Junio disagreed with this design, suggesting that I should reuse the <code>report</code> function.</p><p>The <code>report</code> function is closely tied to object reporting. At the time, I considered adding parameters to the <code>report</code> function and its corresponding callback function <code>error_func</code> to make their prototypes consistent. However, I was not satisfied with this solution because we couldn’t predict whether additional parameters would be needed for other ref checks in the future, which would result in poor extensibility.</p><p>But Patrick gave me a wonderful suggestion which eventually solved the problem:</p><blockquote><p>A better design would likely be to make <code>error_func()</code> receive a <code>void*</code> pointer such that <code>error_func()</code> and then have the respective subsystems provide a function that knows to format the message while receiving either a <code>struct fsck_object_report *</code> or a <code>struct fsck_ref_report *</code>.</p></blockquote><h3 id="Long-Review-Duration"><a href="#Long-Review-Duration" class="headerlink" title="Long Review Duration"></a>Long Review Duration</h3><p>Building the ref consistency check infrastructure posed challenges not only in terms of design and coding but also due to the lengthy review process. This created a significant mental burden for me during the middle of GSoC. This is what I have recorded in my <a href="https://luolibrary.com/2024/07/16/GSoC-Week-7/">GSoC Week 7</a> blog:</p><blockquote><p>The recent challenges I’ve encountered mainly stem from two aspects. Over the past two weeks, I’ve felt mentally exhausted because I haven’t received much positive feedback. Since May 30th, my first patch is still under review. Sometimes, I can’t help but feel the pressure from my peers. Seeing other GSoC participants successfully merge several patches does indeed make me feel pressured. Therefore, I realize that I must learn how to adjust my mindset during prolonged review periods.</p></blockquote><h2 id="After-GSoC"><a href="#After-GSoC" class="headerlink" title="After GSoC"></a>After GSoC</h2><p>After GSoC, I decided to remain involved with the Git community to continue the work I need to complete. My tentative roadmap is as follows:</p><ol><li>Implement the pack-refs consistency check for the files backend.</li><li>Implement the reflogs consistency check for the files backend.</li><li>Implement the consistency check for the reftable backend.</li><li>Separate the object database check logic from <code>git-fsck(1)</code>.</li><li>Enhance the <code>git-fsck(1)</code> command to allow users to easily disable subprocess checks, providing greater flexibility.</li></ol><p>There is a lot to accomplish, which is exciting!</p><h2 id="Closing-Remarks"><a href="#Closing-Remarks" class="headerlink" title="Closing Remarks"></a>Closing Remarks</h2><p>During my GSoC journey, besides improving my coding skills, I believe the greatest gain was strengthening connections between people. I established a good relationship with my two mentors, Patrick and Karthik. Initially, I rarely conversed in English with others, and during my first video meeting with Patrick, I was quite nervous, worried about my limited English speaking skills.</p><p>Additionally, I feel that I have built a good relationship with the Git community. Through an open-source project, I experienced the charm of open source, as it connects people who might not have otherwise crossed paths in life.</p><p>I am especially grateful to my two mentors from GitLab, <a href="https://gitlab.com/pks-gitlab">Patrick</a> and <a href="https://www.linkedin.com/in/karthik%2Dnayak/">Karthik</a>. They provided me with a lot of guidance, embodying the role of a teacher who imparts knowledge and resolves doubts. I also want to thank <a href="https://github.com/gitster/">Junio</a>, Eric, and <a href="https://www.linkedin.com/in/justintobler/">Justin</a> for their meticulous and detailed work during the code review process, which made the final implementation exceptionally elegant.</p><p>I also feel quite proud of myself for being able to implement a new feature for foundational software used by so many people, something I once thought could only happen in my dreams. I am very grateful for this experience and hope that I can become a mentor in the future, igniting the flame in others’ hearts.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;Suddenly, I recalled myself writing the proposal back then, and I couldn’t help but feel a bit wistful. Every time it ends, there’s</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>GSoC Week 10-11</title>
    <link href="https://luolibrary.com/2024/08/13/GSoC-Week-10-11/"/>
    <id>https://luolibrary.com/2024/08/13/GSoC-Week-10-11/</id>
    <published>2024-08-13T13:41:26.000Z</published>
    <updated>2024-08-13T13:41:42.024Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What-I-Have-Done"><a href="#What-I-Have-Done" class="headerlink" title="What I Have Done"></a>What I Have Done</h2><p>In these two weeks, I continue to solve the reviews. After I have sent the <a href="https://lore.kernel.org/git/ZqeXrPROpEg_pRS2@ArchLinux/">Patch v13</a>. Patrick gives an opinion here, we want to reuse the <code>fsck_vreport</code> function here. We want to make it generic but we design the callback not generic. And Patrick gives a wonderful idea here:</p><blockquote><p>A better design would likely be to make <code>error_func()</code> receive a <code>void*</code> pointer such that <code>error_func()</code> and then have the respective subsystems provide a function that knows to format the message while receiving either a <code>struct fsck_object_report *</code> or a <code>struct fsck_ref_report *</code>.</p></blockquote><p>However, Patrick thinks we may put unnecessary effort here to make things complicated again. But after discussion, I think we should use the below design for the following reasons:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span> <span class="params">(*fsck_error)</span><span class="params">(<span class="keyword">struct</span> fsck_options *o,</span></span><br><span class="line"><span class="params">                          <span class="type">void</span> *info,</span></span><br><span class="line"><span class="params">                          <span class="keyword">enum</span> fsck_msg_type msg_type, <span class="keyword">enum</span> fsck_msg_id msg_id,</span></span><br><span class="line"><span class="params">                          <span class="type">const</span> <span class="type">char</span> *message)</span>;</span><br></pre></td></tr></table></figure><ol><li>We only expose one interface called <code>fsck_reportf</code> which will make the code clear. Actually, there is no different between reporting refs and reporting objects.</li><li>We provide more extensibility here, because we will never change <code>fsck_reportf</code> and <code>fsck_error</code> prototype when we want to add more info for either refs or objects.</li></ol><p>And Patrick advices me that I should drop the last patch “[PATCH v13 10&#x2F;10] fsck: add ref content check for files backend”, because we should speed up the review process due to the ddl of GSoC.</p><p>And Junio gives two advices:</p><ol><li>The prototype of <code>files_fsck_refs_fn</code> should adapt to the Patrick’s new change.</li><li>Unless the most common use of an array is to pass it around as a collection of items and operate on the collection, it is a better practice to name an array with a singular noun.  Name the array as <code>fsck_refs_fn[]</code> not <code>fsck_refs_fns[]</code>.</li></ol><p>I solve these problems in <a href="https://lore.kernel.org/git/ZqulmWVBaeyP4blf@ArchLinux/">Patch v14</a>:</p><ol><li>By following the advice from Patrick, we should make the callback function be generic by adding only one <code>void *fsck_report</code> parameter. Thus the commit sequence will be much more clearer. And it wll be much easier for reviewers to review. And I have split the commit into more commits in this version.</li><li>Enhance the commit messages to provide more context about why we should do this.</li><li>Patrick advices that we should initialize the <code>fsck_options</code> member when parsing the options. However, because the original <code>strict</code> and <code>verbose</code> field are defined as the bit field, we cannot take the address of them. So I simply remove the bit field.</li><li>As Patrick said, “.lock” should not be reported as error. At current, ignore files ending with “.lock”.</li><li>Add a fsck msg type called “badRefFiletype” which indicates that a ref has a bad file type when scanning the directory.</li><li>Junio advices instead of using <code>fsck_refs_fns</code>, we should use the singular version <code>fsck_refs_fn</code>, fix this.</li><li>Drop the last patch because in this series, we mainly focus on the infra, I will add a series later to add ref content check.</li></ol><p>And I only do some minor changes in <a href="https://lore.kernel.org/git/ZrEBKjzbyxtMdCCx@ArchLinux/">Patch v15</a> and <a href="https://lore.kernel.org/git/ZrSqMmD-quQ18a9F@ArchLinux.localdomain/">Patch v16</a>.</p><p>The code is merged into <a href="https://github.com/git/git/commit/3bde10da94b1424849233d19eeeab475c7a57152">next</a>. What a long journey.</p><h2 id="Next-Plan"><a href="#Next-Plan" class="headerlink" title="Next Plan"></a>Next Plan</h2><p>My GSoC is going to end. But my contribution to Git will bot end. I will implement ref content check. And I will concentrate on writing the final report.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;What-I-Have-Done&quot;&gt;&lt;a href=&quot;#What-I-Have-Done&quot; class=&quot;headerlink&quot; title=&quot;What I Have Done&quot;&gt;&lt;/a&gt;What I Have Done&lt;/h2&gt;&lt;p&gt;In these two</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>MIT6.824: MapReduce</title>
    <link href="https://luolibrary.com/2024/08/04/MIT6-824-MapReduce/"/>
    <id>https://luolibrary.com/2024/08/04/MIT6-824-MapReduce/</id>
    <published>2024-08-04T07:13:57.000Z</published>
    <updated>2024-08-04T12:26:27.367Z</updated>
    
    <content type="html"><![CDATA[<p>This is my record for finish MIT 6.824(spring 2022) first lab <a href="http://nil.csail.mit.edu/6.824/2022/labs/lab-mr.html">MapReduce</a>.</p><h2 id="Sequence-Version"><a href="#Sequence-Version" class="headerlink" title="Sequence Version"></a>Sequence Version</h2><p>Before we dive into how to solve this problem, we first need to understand the sequence version. First, we look at how <code>Map</code> operates.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">intermediate := []mr.KeyValue&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> _ filename := <span class="keyword">range</span> os Args[<span class="number">2</span>:] &#123;</span><br><span class="line">  file, err := os.Open(filename)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatalf(<span class="string">&quot;cannot open %v&quot;</span>, filename)</span><br><span class="line">  &#125;</span><br><span class="line">  content, err := io.ReadAll(file)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatalf(<span class="string">&quot;cannot read %v&quot;</span>, filename)</span><br><span class="line">  &#125;</span><br><span class="line">  file.Close()</span><br><span class="line">  kva := mapf(filename, <span class="type">string</span>(content))</span><br><span class="line">  intermediate = <span class="built_in">append</span>(intermediate, kva...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The idea for above code is simple. It just calls the user-provided <code>Map</code> function to generate the key-value pair struct <code>mr.KeyValue</code> and put the results into <code>intermediate</code>.</p><p>Next we need to partitioning the <code>intermediate</code> to make it into groups. Actually, we can just sort the results. This is also what the code does.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort.Sort(ByKey(intermediate))</span><br></pre></td></tr></table></figure><p>Now next we need to call user-provided <code>Reduce</code> function. This is also easy. We have already sorted the <code>intermediate</code>. Now we just handle the groups one by one.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i &lt; <span class="built_in">len</span>(intermediate) &#123;</span><br><span class="line">  j := i + <span class="number">1</span></span><br><span class="line">  <span class="keyword">for</span> j &lt; <span class="built_in">len</span>(intermediate) &amp;&amp; intermediate[j].key == intermediate[i].key &#123;</span><br><span class="line">    j++</span><br><span class="line">  &#125;</span><br><span class="line">  values := []<span class="type">string</span>&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> k := i; k &lt; j; k++ &#123;</span><br><span class="line">    values = <span class="built_in">append</span>(values, intermediate[k].Value)</span><br><span class="line">  &#125;</span><br><span class="line">  output := reducef(intermediate[i].Key, values)</span><br><span class="line">  fmt.Fprintf(ofile, <span class="string">&quot;%v %v\n&quot;</span>, intermediate[i].Key, output)</span><br><span class="line">  i = j</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Need-Analysis"><a href="#Need-Analysis" class="headerlink" title="Need Analysis"></a>Need Analysis</h2><h3 id="Coordinator"><a href="#Coordinator" class="headerlink" title="Coordinator"></a>Coordinator</h3><p>For MapReduce, there should be a coordinator which allocates the tasks. And the coordinator should use data structure to hold the status. The coordinator could not record the result file of the <code>Map</code> operation, because we have used some rules to make a pattern match.</p><h3 id="Worker"><a href="#Worker" class="headerlink" title="Worker"></a>Worker</h3><p>However, for a worker, things would be complicated. In the code, worker could do both <code>Map</code> and <code>Reduce</code>. I don’t think it is a good idea to make them exclusively. So for a worker, it should start two goroutines, one for <code>Map</code> and another for <code>Reduce</code>.</p><p>For <code>Map</code> operation, we should achieve the following functionality:</p><ul><li>Divide the intermediate keys into buckets for <code>nReduce</code> reduce tasks where <code>nReduce</code> is the number of reduce tasks.</li><li>The intermediate files name should be <code>mr-X-Y</code>, where <code>X</code> is the Map task number, and <code>Y</code> is the reduce task number.</li><li>Use <code>encoding/json</code> package to write the key&#x2F;value pairs in JSON format to intermediate files.</li></ul><p>For <code>Reduce</code> operation, we should achieve the following functionality:</p><ul><li>Use <code>encoding/json</code> package to read the key&#x2F;value paris in JSON format from intermediate files.</li><li>Put the output of the Xth reduce task in the file <code>mr-out-X</code>.</li></ul><h2 id="Data-Structure-Design"><a href="#Data-Structure-Design" class="headerlink" title="Data Structure Design"></a>Data Structure Design</h2><p>There are the following things we need to consider:</p><ul><li><p>We need to use the semantic words to represent the states both for the coordinator and workers. However, golang doesn’t provide <code>enum</code> type like C&#x2F;C++. So I decide to use <code>const</code> to emulate the <code>enum</code> type like the following:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> WorkingStatus <span class="type">int32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  idle       WorkingStatus = <span class="number">0</span></span><br><span class="line">  processing WorkingStatus = <span class="number">1</span></span><br><span class="line">  failed     WorkingStatus = <span class="number">2</span></span><br><span class="line">  terminated WorkingStatus = <span class="number">3</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>We need to store the tasks we need to handle in the coordinator and also we need to allocate this task for worker. So we need a way to represent the <code>Map</code> and <code>Reduce</code> task.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MapTask <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID       <span class="type">int</span>    <span class="comment">// the current map task id</span></span><br><span class="line">  Filename <span class="type">string</span> <span class="comment">// the file which the map task is processing</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReduceTask <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID           <span class="type">int</span> <span class="comment">// the current reduce task id</span></span><br><span class="line">  MapTaskTotal <span class="type">int</span> <span class="comment">// the current total map task num for the reduce task</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>We need to store the worker information, because the worker may crash. If we do not store this state, we cannot do any crash recovery. Because a worker will handle <code>Map</code>and <code>Reduce</code> task, so we need to also create states to hold task status. I create a <code>WorkerState</code> to combine the <code>MapWorker</code> and <code>ReduceWorker</code>.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MapWorker <span class="keyword">struct</span> &#123;</span><br><span class="line">status    WorkingStatus <span class="comment">// status</span></span><br><span class="line">task      MapTask       <span class="comment">// current task</span></span><br><span class="line">startTime time.Time     <span class="comment">// map task start time</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReduceWorker <span class="keyword">struct</span> &#123;</span><br><span class="line">  status    WorkingStatus <span class="comment">// status</span></span><br><span class="line">  task      ReduceTask    <span class="comment">// current task</span></span><br><span class="line">  startTime time.Time     <span class="comment">// reduce task start time</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> WorkerState <span class="keyword">struct</span> &#123;</span><br><span class="line">  id           <span class="type">int</span>          <span class="comment">// Worker identifier</span></span><br><span class="line">  mapWorker    MapWorker    <span class="comment">// the map worker</span></span><br><span class="line">  reduceWorker ReduceWorker <span class="comment">// the reduce worker</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>And we could the following data structure for coordinator:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Coordinator <span class="keyword">struct</span> &#123;</span><br><span class="line">  worker                []WorkerState <span class="comment">// To store the status of the workers</span></span><br><span class="line">  mapTask               []MapTask     <span class="comment">// The map tasks to be done</span></span><br><span class="line">  reduceTask            []ReduceTask  <span class="comment">// The reduce tasks to be done</span></span><br><span class="line">  mapTaskNum            <span class="type">int</span>           <span class="comment">// The total number of map task</span></span><br><span class="line">  reduceTaskNum         <span class="type">int</span>           <span class="comment">// The total number of reduce task</span></span><br><span class="line">  mapTaskFinishedNum    <span class="type">int</span>           <span class="comment">// The number of mapTask finished</span></span><br><span class="line">  reduceTaskFinishedNum <span class="type">int</span>           <span class="comment">// The number of reduceTask finished</span></span><br><span class="line">  allMapFinished        <span class="type">bool</span>          <span class="comment">// To indicate whether all Map operations are finished</span></span><br><span class="line">  allReduceFinished     <span class="type">bool</span>          <span class="comment">// To indicate whether all Reduce operations are finished</span></span><br><span class="line">  status                WorkingStatus <span class="comment">// The status of the coordinator</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RPC-Operations"><a href="#RPC-Operations" class="headerlink" title="RPC Operations"></a>RPC Operations</h2><p>Next, we need to handle the rpc operations where we need to consider the synchronization between workers and coordinator.</p><h3 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h3><p>When a worker is initialized, it should call <code>Register</code> RPC. The coordinator should lock the mutex and update the <code>worker</code> field and return the id and the reduce bucket to the worker like the following:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RegisterRequest <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RegisterResponse <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID      <span class="type">int</span> <span class="comment">// the worker identifier</span></span><br><span class="line">  NReduce <span class="type">int</span> <span class="comment">// the reduce bucket</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> Register(request *RegisterRequest, response *RegisterResponse) <span class="type">error</span> &#123;</span><br><span class="line">  mutex.Lock()</span><br><span class="line">  <span class="keyword">defer</span> mutex.Unlock()</span><br><span class="line"></span><br><span class="line">  newId := <span class="built_in">len</span>(c.worker)</span><br><span class="line"></span><br><span class="line">  newWorker := WorkerState&#123;</span><br><span class="line">    id: newId,</span><br><span class="line">    mapWorker: MapWorker&#123;</span><br><span class="line">      status: idle,</span><br><span class="line">    &#125;,</span><br><span class="line">    reduceWorker: ReduceWorker&#123;</span><br><span class="line">      status: idle,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  c.worker = <span class="built_in">append</span>(c.worker, newWorker)</span><br><span class="line"></span><br><span class="line">  response.ID = newId</span><br><span class="line">  response.NReduce = c.reduceTaskNum</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Request-Map-Task"><a href="#Request-Map-Task" class="headerlink" title="Request Map Task"></a>Request Map Task</h3><p>When the workers want to request map task, it should call <code>MapRequest</code> RPC. However, when there is no task available allocated to the worker, we should block the process in RPC call. You could see the following code to understand the detail.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MapTaskRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID <span class="type">int</span> <span class="comment">// the worker identifier</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MapTaskResponse <span class="keyword">struct</span> &#123;</span><br><span class="line">  Task     MapTask</span><br><span class="line">  Shutdown <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> MapRequest(</span><br><span class="line">  request *MapTaskRequest,</span><br><span class="line">  response *MapTaskResponse) <span class="type">error</span> &#123;</span><br><span class="line"></span><br><span class="line">  condMap.L.Lock()</span><br><span class="line">  <span class="keyword">defer</span> condMap.L.Unlock()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Here, we use `len(c.filenames)` to indicate whether there is</span></span><br><span class="line">  <span class="comment">// an available task for `Map` operation.</span></span><br><span class="line">  <span class="keyword">for</span> <span class="built_in">len</span>(c.mapTask) == <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If all of the `Map` operation is finished, we should</span></span><br><span class="line">    <span class="comment">// set the `Shutdown` field to `true` and return.</span></span><br><span class="line">    <span class="keyword">if</span> c.allMapFinished &#123;</span><br><span class="line">      response.Shutdown = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    condMap.Wait()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We should return map task back to the `Map`</span></span><br><span class="line">  response.Task = c.mapTask[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Here, we should store the information of the worker</span></span><br><span class="line">  c.worker[request.ID].mapWorker.task = c.mapTask[<span class="number">0</span>]</span><br><span class="line">  c.worker[request.ID].mapWorker.status = processing</span><br><span class="line">  c.worker[request.ID].mapWorker.startTime = time.Now()</span><br><span class="line"></span><br><span class="line">  c.mapTask = c.mapTask[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Finish-Map-Task"><a href="#Finish-Map-Task" class="headerlink" title="Finish Map Task"></a>Finish Map Task</h3><p>When the workers finish the <code>Map</code> operation, it should call <code>MapFinish</code> to indicate the coordinator that “I have finished this task”. However, there are so many details we need to consider:</p><ol><li>There are some tasks running too much time which we will consider they are failed. If later the coordinator receives the <code>MapFinish</code> request, we should simply indicate the workers that they should be shutdown.</li><li>Because the workers may crash, we should never write the real name here. Instead workers should create temp file name. The coordinator should rename this in the RPC call. So we need to add a new field <code>Info</code> representing the mapping between the temp file name and the original file name.</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MapTaskRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  Info <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> MapFinish(</span><br><span class="line">  request *MapTaskRequest,</span><br><span class="line">  response *MapTaskResponse) <span class="type">error</span> &#123;</span><br><span class="line"></span><br><span class="line">  mutex.Lock()</span><br><span class="line">  <span class="keyword">defer</span> mutex.Unlock()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> c.worker[request.ID].mapWorker.status == failed ||</span><br><span class="line">    c.allMapFinished &#123;</span><br><span class="line">    response.Shutdown = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> c.worker[request.ID].mapWorker.status == processing &amp;&amp; !c.allMapFinished &#123;</span><br><span class="line"></span><br><span class="line">    c.mapTaskFinishedNum++</span><br><span class="line"></span><br><span class="line">    c.worker[request.ID].mapWorker.status = idle</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> temp, original := <span class="keyword">range</span> request.Info &#123;</span><br><span class="line">      os.Rename(temp, original)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When all the `Map` operation is finished we should broadcast for</span></span><br><span class="line">    <span class="comment">// `Reduce` operation. Pay attention that `len(c.filenames) == 0`</span></span><br><span class="line">    <span class="keyword">if</span> c.mapTaskFinishedNum == c.mapTaskNum &#123;</span><br><span class="line">      c.allMapFinished = <span class="literal">true</span></span><br><span class="line">      condReduce.Broadcast()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>The <code>ReduceRequest</code> and <code>ReduceFinish</code> functions are like <code>MapRequest</code> and <code>MapFinish</code>. I omit the detail here.</p><h2 id="Coordinator-Operations"><a href="#Coordinator-Operations" class="headerlink" title="Coordinator Operations"></a>Coordinator Operations</h2><p>There are two operations we need to consider for coordinator, one is that coordinator needs to check the liveness of the each worker for executing crash recovery. I define a goroutine <code>checkLiveness</code> here.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> checkLiveness() &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line"></span><br><span class="line">    done := c.Done()</span><br><span class="line">    <span class="keyword">if</span> done &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mutex.Lock()</span><br><span class="line"></span><br><span class="line">    mapRestartTime := <span class="number">0</span></span><br><span class="line">    reduceRestartTime := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> c.worker &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> c.worker[i].mapWorker.status == processing &amp;&amp; time.Since(c.worker[i].mapWorker.startTime).Seconds() &gt; <span class="number">10</span> &#123;</span><br><span class="line">        mapRestartTime++</span><br><span class="line">        c.mapTask = <span class="built_in">append</span>(c.mapTask, MapTask&#123;</span><br><span class="line">          ID:       c.worker[i].mapWorker.task.ID,</span><br><span class="line">          Filename: c.worker[i].mapWorker.task.Filename,</span><br><span class="line">        &#125;)</span><br><span class="line">        c.worker[i].mapWorker.status = failed</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> c.worker[i].reduceWorker.status == processing &amp;&amp; time.Since(c.worker[i].reduceWorker.startTime).Seconds() &gt; <span class="number">10</span> &#123;</span><br><span class="line">        reduceRestartTime++</span><br><span class="line">        c.reduceTask = <span class="built_in">append</span>(c.reduceTask, ReduceTask&#123;</span><br><span class="line">          MapTaskTotal: c.worker[i].reduceWorker.task.MapTaskTotal,</span><br><span class="line">          ID:           c.worker[i].reduceWorker.task.ID,</span><br><span class="line">        &#125;)</span><br><span class="line">        c.worker[i].reduceWorker.status = failed</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; mapRestartTime; i++ &#123;</span><br><span class="line">      condMap.Signal()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; reduceRestartTime; i++ &#123;</span><br><span class="line">      condReduce.Signal()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mutex.Unlock()</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Worker-Operations"><a href="#Worker-Operations" class="headerlink" title="Worker Operations"></a>Worker Operations</h2><p>The entrypoint is the <code>Worker</code> function, we will start two goroutine in this function, one is used for handling <code>mapProcess</code> and the other is used for handling <code>reduceProcess</code>.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Worker</span><span class="params">(mapf <span class="keyword">func</span>(<span class="type">string</span>, <span class="type">string</span>)</span></span> []KeyValue,</span><br><span class="line">  reducef <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">string</span>, []<span class="type">string</span>)</span></span> <span class="type">string</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// When there is a new worker, we should call RPC</span></span><br><span class="line">  <span class="comment">// `RegisterRPC`.</span></span><br><span class="line">  response := RegisterResponse&#123;&#125;</span><br><span class="line">  request := RegisterRequest&#123;&#125;</span><br><span class="line">  mutex = sync.Mutex&#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> !RegisterRPC(&amp;request, &amp;response) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> mapProcess(mapf, response.ID, response.NReduce)</span><br><span class="line">  <span class="keyword">go</span> reduceProcess(reducef, response.ID, response.NReduce)</span><br><span class="line"></span><br><span class="line">  wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>mapProcess</code> goroutine will handle the following things:</p><ol><li>Firstly uses <code>MapRequestRPC</code> to request one job from coordinator, and the most two important things got from coordinator is the <code>MapTask</code> structure.</li><li>We need to maintain the mapping between the temp file name and the original filename.</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapProcess</span><span class="params">(mapf <span class="keyword">func</span>(<span class="type">string</span>, <span class="type">string</span>)</span></span> []KeyValue, id <span class="type">int</span>, nReduce <span class="type">int</span>) &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line"></span><br><span class="line">    request := MapTaskRequest&#123;ID: id&#125;</span><br><span class="line">    response := MapTaskResponse&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> !MapRequestRPC(&amp;request, &amp;response) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the coordinator is terminated, we should terminate</span></span><br><span class="line">    <span class="comment">// the `mapProcess`</span></span><br><span class="line">    <span class="keyword">if</span> response.Shutdown &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tempToOriginal := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">    intermediate := []KeyValue&#123;&#125;</span><br><span class="line">    filename := response.Task.Filename</span><br><span class="line">    file, _ := os.Open(filename)</span><br><span class="line">    content, _ := io.ReadAll(file)</span><br><span class="line">    file.Close()</span><br><span class="line">    kva := mapf(filename, <span class="type">string</span>(content))</span><br><span class="line">    intermediate = <span class="built_in">append</span>(intermediate, kva...)</span><br><span class="line"></span><br><span class="line">    outputNamePrefix := fmt.Sprintf(<span class="string">&quot;mr-%d-&quot;</span>, response.Task.ID)</span><br><span class="line"></span><br><span class="line">    outputFile := []*os.File&#123;&#125;</span><br><span class="line">    enc := []*json.Encoder&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= nReduce; i++ &#123;</span><br><span class="line">      outputName := fmt.Sprintf(<span class="string">&quot;%s%d&quot;</span>, outputNamePrefix, i)</span><br><span class="line">      tempFile, _ := os.CreateTemp(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;tempfile-&quot;</span>)</span><br><span class="line">      tempToOriginal[tempFile.Name()] = outputName</span><br><span class="line"></span><br><span class="line">      encTemp := json.NewEncoder(tempFile)</span><br><span class="line">      outputFile = <span class="built_in">append</span>(outputFile, tempFile)</span><br><span class="line">      enc = <span class="built_in">append</span>(enc, encTemp)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, kv := <span class="keyword">range</span> intermediate &#123;</span><br><span class="line">      reduceNum := ihash(kv.Key) % nReduce</span><br><span class="line">      enc[reduceNum].Encode(kv)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, file := <span class="keyword">range</span> outputFile &#123;</span><br><span class="line">      file.Close()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.Info = tempToOriginal</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> !MapFinishRPC(&amp;request, &amp;response) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k := <span class="keyword">range</span> tempToOriginal &#123;</span><br><span class="line">      <span class="built_in">delete</span>(tempToOriginal, k)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>reduceProcess</code> is just the same as <code>mapProcess</code>. Actually, from my perspective, there is nothing different.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reduceProcess</span><span class="params">(reducef <span class="keyword">func</span>(<span class="type">string</span>, []<span class="type">string</span>)</span></span> <span class="type">string</span>, id <span class="type">int</span>, nReduce <span class="type">int</span>) &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line"></span><br><span class="line">    request := ReduceTaskRequest&#123;ID: id&#125;</span><br><span class="line">    response := ReduceTaskResponse&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> !ReduceRequestRPC(&amp;request, &amp;response) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> response.Shutdown &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    intermediate := []KeyValue&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= response.Task.MapTaskTotal; i++ &#123;</span><br><span class="line">      inputName := fmt.Sprintf(<span class="string">&quot;mr-%d-%d&quot;</span>, i, response.Task.ID)</span><br><span class="line">      file, _ := os.Open(inputName)</span><br><span class="line">      dec := json.NewDecoder(file)</span><br><span class="line">      <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> temp KeyValue</span><br><span class="line">        <span class="keyword">if</span> err := dec.Decode(&amp;temp); err != <span class="literal">nil</span> &#123;</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        intermediate = <span class="built_in">append</span>(intermediate, temp)</span><br><span class="line">      &#125;</span><br><span class="line">      file.Close()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sort.Sort(ByKey(intermediate))</span><br><span class="line"></span><br><span class="line">    temporaryToOriginal := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">    outputName := fmt.Sprintf(<span class="string">&quot;mr-out-%d&quot;</span>, response.Task.ID)</span><br><span class="line">    tempFile, _ := os.CreateTemp(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;tempfile-&quot;</span>)</span><br><span class="line">    temporaryToOriginal[tempFile.Name()] = outputName</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i &lt; <span class="built_in">len</span>(intermediate) &#123;</span><br><span class="line">      j := i + <span class="number">1</span></span><br><span class="line">      <span class="keyword">for</span> j &lt; <span class="built_in">len</span>(intermediate) &amp;&amp; intermediate[j].Key == intermediate[i].Key &#123;</span><br><span class="line">        j++</span><br><span class="line">      &#125;</span><br><span class="line">      values := []<span class="type">string</span>&#123;&#125;</span><br><span class="line">      <span class="keyword">for</span> k := i; k &lt; j; k++ &#123;</span><br><span class="line">        values = <span class="built_in">append</span>(values, intermediate[k].Value)</span><br><span class="line">      &#125;</span><br><span class="line">      output := reducef(intermediate[i].Key, values)</span><br><span class="line">      fmt.Fprintf(tempFile, <span class="string">&quot;%v %v\n&quot;</span>, intermediate[i].Key, output)</span><br><span class="line">      i = j</span><br><span class="line">    &#125;</span><br><span class="line">    tempFile.Close()</span><br><span class="line">    request.Info = temporaryToOriginal</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> !ReduceFinishRPC(&amp;request, &amp;response) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;This is my record for finish MIT 6.824(spring 2022) first lab &lt;a</summary>
        
      
    
    
    
    <category term="MIT6.824" scheme="https://luolibrary.com/categories/MIT6-824/"/>
    
    
    <category term="技术" scheme="https://luolibrary.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="学习" scheme="https://luolibrary.com/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>GSoC Week 8-9</title>
    <link href="https://luolibrary.com/2024/07/28/GSoC-Week-8-9/"/>
    <id>https://luolibrary.com/2024/07/28/GSoC-Week-8-9/</id>
    <published>2024-07-28T15:31:46.000Z</published>
    <updated>2024-07-28T15:31:59.754Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What-I-Have-Done"><a href="#What-I-Have-Done" class="headerlink" title="What I Have Done"></a>What I Have Done</h2><p>In these two weeks, I mainly focus on solving the reviews. After I have sent the <a href="https://lore.kernel.org/git/ZpPEdmUN1Z5tqbK3@ArchLinux/">Patch v11</a> to the mailing list. Karthik suggests that instead of using <code>ref_checkee</code> and <code>sub_ref_checkee</code>, we may use the following data structure to provide more extensibility here.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fsck_refs_info</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> *refname;</span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125; reftable;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125; files;</span><br><span class="line">       &#125; u;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So in <a href="https://lore.kernel.org/git/ZpuCg1GL1YE_sJBP@ArchLinux/">patch v12</a>, I implement the above data structure.</p><p>However, Patrick has a different opinion about this. Patrick thinks this is too complicated. We should make thing simple here. Instead of using a union to represent the options, why we not just use a flat structure here. So I just use the following data structure:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fsck_refs_info</span> &#123;</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It’s simple and we reserve the extensibility here. The code is under review in the <a href="https://github.com/shejialuo/git/pull/11">github</a>. I have already solve the review from Karthik. However, due to the reason that Patrick has just come back to Office. I am waiting for the reviews from Patrick. When everything is OK, I will send the Patch v13 to the mailing list.</p><p>What a long journey!</p><h2 id="Next-Plan"><a href="#Next-Plan" class="headerlink" title="Next Plan"></a>Next Plan</h2><p>Continue to handle the reviews.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;What-I-Have-Done&quot;&gt;&lt;a href=&quot;#What-I-Have-Done&quot; class=&quot;headerlink&quot; title=&quot;What I Have Done&quot;&gt;&lt;/a&gt;What I Have Done&lt;/h2&gt;&lt;p&gt;In these two</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>GSoC Week 7</title>
    <link href="https://luolibrary.com/2024/07/16/GSoC-Week-7/"/>
    <id>https://luolibrary.com/2024/07/16/GSoC-Week-7/</id>
    <published>2024-07-16T13:45:49.000Z</published>
    <updated>2024-07-16T13:46:06.115Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What-I-Have-Done"><a href="#What-I-Have-Done" class="headerlink" title="What I Have Done"></a>What I Have Done</h2><p>In this week, I still put my effort on handling reviews.</p><ul><li><a href="https://lore.kernel.org/git/Zo0sQCBqyxX8dJ-f@ArchLinux/">Patch v9</a>: In version 8, Karthik thinks that instead of renaming <code>skiplist</code> to <code>oid_skiplist</code>, we’d better rename <code>skiptlist</code> to <code>skip_oids</code>. So, I simply apply this idea. And I have made a mistake in version 8, I use the <code>static</code> for a string buf, but I forget to use <code>strbuf_reset</code> for each function call. So I add this statement here. However, Eric thinks that using <code>static</code> variable is a very bad idea, because <code>fsck_refs_error_function</code> should not be called frequently. The design will make the code harder to “libify”. This is one thing I have learned. And Justin has provided some reviews about the commit sequence and commit messages, need to make it clearer.</li><li><a href="https://lore.kernel.org/git/Zo6eJi8BePrQxTQV@ArchLinux/">Patch v10</a>: This patch solves the problem of version 9. But there are some new reviews coming from Junio. The first problem is that we should not name the report interface <code>vfsck_report</code> but “fsck_vreport”, and Junio feels that the current commit sequence is not so clear, need to adjust.</li></ul><p>However, In patch v10, the most important question Junio asks is about the functionality <code>fsck_refs_error_function</code>. The declaration of this function in patch v10 is shown below:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fsck_refs_error_function</span><span class="params">(<span class="keyword">struct</span> fsck_options *options UNUSED,</span></span><br><span class="line"><span class="params">                             <span class="type">const</span> <span class="keyword">struct</span> object_id *oid,</span></span><br><span class="line"><span class="params">                             <span class="keyword">enum</span> object_type object_type UNUSED,</span></span><br><span class="line"><span class="params">                             <span class="type">const</span> <span class="type">char</span> *checked_ref_name,</span></span><br><span class="line"><span class="params">                             <span class="keyword">enum</span> fsck_msg_type msg_type,</span></span><br><span class="line"><span class="params">                             <span class="keyword">enum</span> fsck_msg_id msg_id UNUSED,</span></span><br><span class="line"><span class="params">                             <span class="type">const</span> <span class="type">char</span> *message )</span>;</span><br></pre></td></tr></table></figure><p>Junio thinks above declaration only handles the problem of the single ref such as <code>refs/heads/main</code>. What about the packed-refs?</p><blockquote><p>The error reporting function for refs consistency check was still about reporting a problem for a single ref.  I am wondering how consistency violations that are not about a single ref should be handled.  For example, if <code>refs/packed-backend.c:packed_fsck()</code> finds that the file is not sorted properly or has some unparsable garbage in it, it is not something you can report as “refs&#x2F;heads&#x2F;main is broken”, but those who are interested in seeing the “reference database consistency” verified, it is very much what they want the tool to notice.</p></blockquote><p>So I need to find a way to handle this. So I decide to look at the spec of the packed-refs and reftable refs. And I finally find a way to do this.</p><p>After some investigations, there are the following situations where we should handle when checking ref consistency.</p><ol><li>When checking loose refs and reflofs, we only need the <code>checkee</code> information, because they are standalone files.</li><li>When checking packed-refs, we should check the packed-refs itself, for example whether it is sorted or there are some garbage trailing contents. However, we should also check each ref (<code>sub_checkee</code>) in the file.</li><li>When checking reftable refs, we need to check the binary file, we could still use the idea like 2 case.</li></ol><p>By the above statements, I change the <code>fsck_refs_error_function</code> shown as below:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fsck_refs_error_function</span><span class="params">(<span class="keyword">struct</span> fsck_options *options UNUSED,</span></span><br><span class="line"><span class="params">                             <span class="type">const</span> <span class="keyword">struct</span> object_id *oid,</span></span><br><span class="line"><span class="params">                             <span class="keyword">enum</span> object_type object_type UNUSED,</span></span><br><span class="line"><span class="params">                             <span class="type">const</span> <span class="type">char</span> *ref_checkee,</span></span><br><span class="line"><span class="params">                             <span class="type">const</span> <span class="type">char</span> *sub_ref_checkee,</span></span><br><span class="line"><span class="params">                             <span class="keyword">enum</span> fsck_msg_type msg_type,</span></span><br><span class="line"><span class="params">                             <span class="keyword">enum</span> fsck_msg_id msg_id UNUSED,</span></span><br><span class="line"><span class="params">                             <span class="type">const</span> <span class="type">char</span> *message)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">strbuf</span> <span class="title">sb</span> =</span> STRBUF_INIT;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sub_ref_checkee)</span><br><span class="line">        strbuf_addf(&amp;sb, <span class="string">&quot;%s.%s&quot;</span>, ref_checkee, sub_ref_checkee);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        strbuf_addstr(&amp;sb, ref_checkee);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oid)</span><br><span class="line">        strbuf_addf(&amp;sb, <span class="string">&quot; -&gt; (%s)&quot;</span>, oid_to_hex(oid));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (msg_type == FSCK_WARN)</span><br><span class="line">        warning(<span class="string">&quot;%s: %s&quot;</span>, sb.buf, message);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        ret = error(<span class="string">&quot;%s: %s&quot;</span>, sb.buf, message);</span><br><span class="line"></span><br><span class="line">    strbuf_release(&amp;sb);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It could provide the following report messages:</p><ol><li>“ref_checkee”: “fsck error name”: “user message”.</li><li>“ref_checkee.sub_ref_checkee”: “fsck error name”: “user message”.</li><li>“ref_checkee -&gt; (oid hex)”: “fsck error name”: “user message”.</li><li>“ref_checkee.sub_ref_checkee -&gt; (oid hex)”: “fsck error name”: “user message”.</li></ol><p>This is what I done in <a href="https://lore.kernel.org/git/ZpPEdmUN1Z5tqbK3@ArchLinux/">patch v11</a>.</p><h2 id="Next-Plan"><a href="#Next-Plan" class="headerlink" title="Next Plan"></a>Next Plan</h2><p>It’s important for me to set up the infra of consistency check for refs. Because everything will be built upon that. I think I will continue to handle the reviews.</p><h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><p>The recent challenges I’ve encountered mainly stem from two aspects. Over the past two weeks, I’ve felt mentally exhausted because I haven’t received much positive feedback. Since May 30th, my first patch is still under review. Sometimes, I can’t help but feel the pressure from my peers. Seeing other GSoC participants successfully merge several patches does indeed make me feel pressured. Therefore, I realize that I must learn how to adjust my mindset during prolonged review periods.</p><p>Secondly, there’s the issue raised by Junio regarding how to improve the “fsck_refs_error_function.” Junio actually brought this up in the initial version, but I subconsciously ignored it. Although I am responsible for building the infrastructure, I have limited knowledge about packed-refs and reftable refs. I thought it would be very difficult for me to design a perfect function. However, in the end, I had to face this problem head-on. Sometimes, when I encounter difficult issues, I tend to avoid them subconsciously. Despite this, I eventually found a solution.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;What-I-Have-Done&quot;&gt;&lt;a href=&quot;#What-I-Have-Done&quot; class=&quot;headerlink&quot; title=&quot;What I Have Done&quot;&gt;&lt;/a&gt;What I Have Done&lt;/h2&gt;&lt;p&gt;In this week,</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>GSoC Week 6</title>
    <link href="https://luolibrary.com/2024/07/08/GSoC-Week-6/"/>
    <id>https://luolibrary.com/2024/07/08/GSoC-Week-6/</id>
    <published>2024-07-08T13:38:41.000Z</published>
    <updated>2024-07-16T13:28:10.182Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What-I-Have-Done"><a href="#What-I-Have-Done" class="headerlink" title="What I Have Done"></a>What I Have Done</h2><p>In this week, I mainly focus on solving the reviews.</p><ul><li><a href="https://lore.kernel.org/git/ZoLHtmOKTfxMSxvw@ArchLinux/">Patch v6</a>: In this version, I decide to reduce the complexity. However, I still misunderstood what Junio said, I still explicitly extracts two options <code>fsck_refs_options</code> and <code>fsck_objects_options</code> here. In my view, I suppose we could make the code more clean. However, Junio has commented as the following:<blockquote><p>Just like premature optimization is bad, premature factoring and over-modularization is bad.</p></blockquote></li><li><a href="https://lore.kernel.org/git/ZoVX6sn2C9VIeZ38@ArchLinux/">Patch v7</a>: In this version, I just add a new ref-related field <code>verbose_refs</code> into the <code>fsck_options</code> without any over-modularization.</li><li><a href="https://lore.kernel.org/git/ZovqY4vQnQBAs7PH@ArchLinux/">Patch v8</a>: Some commit messages in Patch v7 are not clear which makes the reviewer confused. Enhance the commit messages in this version.</li></ul><h2 id="Next-Plan"><a href="#Next-Plan" class="headerlink" title="Next Plan"></a>Next Plan</h2><p>I guess this series should be OK. After setting up the infrastructure. I decide to add packed-refs consistency checks with the following steps:</p><ol><li>Get a list of checks that packed-refs should checks, discussing with my mentors and the community.</li><li>Implement the code.</li></ol><h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><p>Since becoming a full-time employee, time has become a bit tight. I will manage my time more efficiently.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;What-I-Have-Done&quot;&gt;&lt;a href=&quot;#What-I-Have-Done&quot; class=&quot;headerlink&quot; title=&quot;What I Have Done&quot;&gt;&lt;/a&gt;What I Have Done&lt;/h2&gt;&lt;p&gt;In this week,</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>GSoC Week 4-5</title>
    <link href="https://luolibrary.com/2024/06/30/GSoC-Week-4-5/"/>
    <id>https://luolibrary.com/2024/06/30/GSoC-Week-4-5/</id>
    <published>2024-06-30T15:50:51.000Z</published>
    <updated>2024-07-08T13:49:20.916Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Personal-Life"><a href="#Personal-Life" class="headerlink" title="Personal Life"></a>Personal Life</h2><p>Due to the need to help prepare for my master’s graduation work and to move to Shanghai to start my job at NVIDIA on July 1st, I have divided the GSoC records into two weeks.</p><h2 id="What-I-Have-Done"><a href="#What-I-Have-Done" class="headerlink" title="What I Have Done"></a>What I Have Done</h2><p>In these two weeks, I mainly work on three tasks:</p><ul><li><a href="https://lore.kernel.org/git/ZnKKy52QFO2UhqM6@ArchLinux">Patch v4</a>: In this version, I correct the previous implementation that attempted to use pointer casting and adopt a composition strategy to design the data structure.</li><li><a href="https://lore.kernel.org/git/Zn4xeoqhCeBCSNvg@ArchLinux">Patch v5</a>: In this version, Junio suggest that I should reuse the existing report code. However, I overcomplicate the issue by setting up two parallel data structures, which increases the complexity of the problem.</li><li>Completed the GSoC midterm evaluation. My mentors have given me some really useful advice, especially.<blockquote><p>Find the balance between building something that can be easily extended in the future vs. something that is specific to the task at hand.</p></blockquote></li></ul><h2 id="Next-Plan"><a href="#Next-Plan" class="headerlink" title="Next Plan"></a>Next Plan</h2><p>The next task is still based on the composition structure of the data. Although Junio provided a data structure using a union, I still find it too complex. I have always wanted my implementation to be extensible, which has slightly deviated from the task I was supposed to do.</p><h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><p>I feel that the biggest challenge over these two weeks has been understanding the reviews. Every time I submit changes based on a review, I tend to veer off course a bit. I feel that the reviewers’ comments are aimed at addressing specific issues, while I always strive for a perfect implementation, which has led to a lot of unnecessary work and made the code more complex.</p><p>How to balance this is something I have decided to think about carefully.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;Personal-Life&quot;&gt;&lt;a href=&quot;#Personal-Life&quot; class=&quot;headerlink&quot; title=&quot;Personal Life&quot;&gt;&lt;/a&gt;Personal Life&lt;/h2&gt;&lt;p&gt;Due to the need to help</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>GSoC Week 3</title>
    <link href="https://luolibrary.com/2024/06/17/GSoC-Week-3/"/>
    <id>https://luolibrary.com/2024/06/17/GSoC-Week-3/</id>
    <published>2024-06-17T05:54:45.000Z</published>
    <updated>2024-06-17T05:54:57.595Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What-I-Have-Done"><a href="#What-I-Have-Done" class="headerlink" title="What I Have Done"></a>What I Have Done</h2><p>This week, I focus on handling the reviews from my mentors and Junio. My mentors have put some comments on the <a href="https://github.com/shejialuo/git/pull/2">PR</a> before I send the patch to the mailing list.</p><h3 id="Reviews-From-Junio"><a href="#Reviews-From-Junio" class="headerlink" title="Reviews From Junio"></a>Reviews From Junio</h3><p>There are many important reviews from Junio. And we have discussed some issues:</p><ol><li>The dangling symref should not be reported by <code>git-fsck(1)</code>. There is a common situation where people would use dangling symref to create the pointee ref. Like Junio said:</li></ol>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git symbolic-ref refs/heads/maint refs/heads/maint-2.46</span><br><span class="line">git branch maint v2.46.0</span><br></pre></td></tr></table></figure><ol start="2"><li>We should change <code>fsck_files_symref</code> to <code>fsck_symref_target</code>. Because we are checking the target not the symref.</li><li>The use of <code>unsigned int *trailing</code> is not proper which will lose a lot of information for the caller.</li><li>The current implementation should check the symbolic link “escape” situation.</li><li>Some error information will cause misleading.</li></ol><h3 id="The-Problems-I-Found"><a href="#The-Problems-I-Found" class="headerlink" title="The Problems I Found"></a>The Problems I Found</h3><p>However, I have still found some problems in the current implementation:</p><ol><li>When checking symref target, the <code>referent</code> buf could be end with <code>&#39;\n&#39;</code>. If we simply pass the <code>referent</code> to <code>check_refname_format</code> function, we will get incorrect behavior.</li><li>The current implementation totally ignores the absolute symbolic link situation.</li><li>The current tests lack testing for symbolic links.I wanna make sure that the symbolic link check will work especially in Windows. I am a little worry about the compatibility.</li></ol><h2 id="Next-Plan"><a href="#Next-Plan" class="headerlink" title="Next Plan"></a>Next Plan</h2><p>So in order to enhance this patch, I will do the following things:</p><ol><li>Change the defined fsck messages and drop the <code>danglingSymref</code>.</li><li>Enhance the checks for symbolic link and add the corresponding tests.</li></ol><h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><p>This week, I spent most of my time addressing reviews. The biggest challenge I encountered was how to reasonably explain my intentions and design ideas when facing others’ reviews. Additionally, understanding the principles and motivations behind the reviews was also challenging. Rather than calling it a challenge, I would say it was a very interesting experience.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;What-I-Have-Done&quot;&gt;&lt;a href=&quot;#What-I-Have-Done&quot; class=&quot;headerlink&quot; title=&quot;What I Have Done&quot;&gt;&lt;/a&gt;What I Have Done&lt;/h2&gt;&lt;p&gt;This week, I</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>GSoC Week 2</title>
    <link href="https://luolibrary.com/2024/06/10/GSoC-Week-2/"/>
    <id>https://luolibrary.com/2024/06/10/GSoC-Week-2/</id>
    <published>2024-06-10T06:01:39.000Z</published>
    <updated>2024-06-10T06:02:00.262Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What-I-Have-Done"><a href="#What-I-Have-Done" class="headerlink" title="What I Have Done"></a>What I Have Done</h2><p>This is the second week of writing code. I spend most of my time reading the <code>git-fsck(1)</code> source code and enhance my first-version patch.</p><h3 id="Understand-Fsck-Message"><a href="#Understand-Fsck-Message" class="headerlink" title="Understand Fsck Message"></a>Understand Fsck Message</h3><p>As Junior has commented:</p><blockquote><p>How well does this interact with the fsck error levels (aka fsck_msg_type), by the way?  It should be made to work well if the current design does not.</p></blockquote><p>So the first thing I do in this week is to understand “fsck message”. It takes me a lot of time here.</p><h3 id="Implement-the-Code"><a href="#Implement-the-Code" class="headerlink" title="Implement the Code"></a>Implement the Code</h3><p>After understand how fsck messages works, I continue to start coding. I mainly do the following things like this <a href="https://github.com/shejialuo/git/pull/2">PR</a> shows:</p><ul><li>add refs check interfaces to interface with fsck error levels.</li><li>set up ref consistency check infrastructure.</li><li>add verify subcommand for builtin <code>git-refs</code>.</li><li>add git-refs verify child process for <code>git-fsck(1)</code>.</li><li>add unified interface for refs scanning for files backend.</li><li>add ref name check for files backend.</li><li>add ref content check for files backend.</li></ul><p>However, due to the <code>git-refs</code> has not been merged into the <code>next</code>. I’ll send the patches to the mailing list until everything is OK.</p><h2 id="Next-Plan"><a href="#Next-Plan" class="headerlink" title="Next Plan"></a>Next Plan</h2><p>I need to understand the <code>git-worktree</code>. The current implementation totally ignores worktree.</p><h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><p>This week, I have encountered numerous challenges. The most difficult part for me has been designing the code.</p><p>In the process of integrating the fsck message into the reference consistency check, I encounter numerous design issues. Should I add two new fields directly to <code>fsck_options</code>, or should I create a new structure and reuse existing functions through polymorphism? I ponder this for a long time and ultimately choose the latter to ensure semantic clarity.</p><p>Additionally, I need to name the new fsck messages, which also takes considerable thought. Since I have to implement a new feature myself, coding is not the most complex part; rather, it is the design. How to design it in a way that makes both the semantics and the code clearer takes up a significant amount of my time.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;What-I-Have-Done&quot;&gt;&lt;a href=&quot;#What-I-Have-Done&quot; class=&quot;headerlink&quot; title=&quot;What I Have Done&quot;&gt;&lt;/a&gt;What I Have Done&lt;/h2&gt;&lt;p&gt;This is the</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>GSoC Week 1</title>
    <link href="https://luolibrary.com/2024/06/02/GSoC-Week-1/"/>
    <id>https://luolibrary.com/2024/06/02/GSoC-Week-1/</id>
    <published>2024-06-02T08:51:10.000Z</published>
    <updated>2024-06-17T05:27:24.112Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What-I-Have-Done"><a href="#What-I-Have-Done" class="headerlink" title="What I Have Done"></a>What I Have Done</h2><p>This is the first week of writing code. I spent most of my time building the infrastructure for the ref consistency check and implementing some consistency checks for the files backend.</p><h3 id="Set-Up-the-Infrastructure"><a href="#Set-Up-the-Infrastructure" class="headerlink" title="Set Up the Infrastructure"></a>Set Up the Infrastructure</h3><p>I reuse the polymorphism provided by <code>ref_storage_be</code> and add a new interface called <code>fsck_fn</code> to facilitate consistency checks for refs as the <a href="https://lore.kernel.org/git/20240530122753.1114818-1-shejialuo@gmail.com/T/#m63c0d98020a814954f26c54c65bf04830bb0862a">refs: setup ref consistency check infrastructure</a> shows. Additionally, I implement dummy methods for different backends to ensure compatibility and extensibility.</p><h3 id="Name-and-Content-Check-For-Files-Backend"><a href="#Name-and-Content-Check-For-Files-Backend" class="headerlink" title="Name and Content Check For Files Backend"></a>Name and Content Check For Files Backend</h3><p>After setting up the infrastructure, I decide to add some basic checks for the file backend. We may need to parse every file located in a specific directory and perform checks on its content or file name. Therefore, I design the following workflow:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iter = dir_iterator_begin(dir, 0);</span><br><span class="line">while (dir_iterator_advance(iter) == ITER_OK)</span><br><span class="line">  if (IS_FILE(iter))</span><br><span class="line">    for (fn = fns; fn; fn++)</span><br><span class="line">      fn(iter)</span><br></pre></td></tr></table></figure><p>And I have written the following code to achieve above pseudo code.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span> <span class="params">(*files_fsck_refs_fn)</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *refs_check_dir,</span></span><br><span class="line"><span class="params">        <span class="keyword">struct</span> dir_iterator *iter)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">files_fsck_refs</span><span class="params">(<span class="keyword">struct</span> ref_store *ref_store,</span></span><br><span class="line"><span class="params">        <span class="type">const</span> <span class="type">char</span>* refs_check_dir,</span></span><br><span class="line"><span class="params">        files_fsck_refs_fn *fsck_refs_fns)</span></span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">while</span> ((iter_status = dir_iterator_advance(iter)) == ITER_OK) &#123;</span><br><span class="line">    error(<span class="string">&quot;test: %s&quot;</span>, iter-&gt;relative_path);</span><br><span class="line">    <span class="keyword">if</span> (S_ISDIR(iter-&gt;st.st_mode)) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (S_ISREG(iter-&gt;st.st_mode)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (files_fsck_refs_fn *fsck_refs_fn = fsck_refs_fns;</span><br><span class="line">          *fsck_refs_fn; fsck_refs_fn++) &#123;</span><br><span class="line">        ret |= (*fsck_refs_fn)(refs_check_dir, iter);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      error(_(<span class="string">&quot;unexpected file type for &#x27;%s&#x27;&quot;</span>), iter-&gt;basename);</span><br><span class="line">      ret = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For name check and content check, we should just following the prototype of <code>files_fsck_refs_fn</code>. Below shows the detail about these two functionalities.</p><ul><li>Name check: use the existing API <code>check_refname_format</code> to check the reference name.</li><li>Content check: check the following two cases.<ul><li>check whether the ref content length is valid and the last character is a newline.</li><li>check whether the content is be range of <code>[0-9a-f]</code>.</li></ul></li></ul><h3 id="Limitations"><a href="#Limitations" class="headerlink" title="Limitations"></a>Limitations</h3><p>There are many limitations for the current implementation:</p><ul><li>The semantic of <code>fsck_fn</code> should be presented either in code using comments or in commit message. As <a href="https://github.com/gitster">Junio</a> said:<blockquote><p>What is the extra blank line doing there?  It makes reader wonder why the .fsck member is somehow very special and different from others.  Is there a valid reason to single it out (and no, “yes this is special because I invented it” does not count as a valid reason)? The same comment applies to a few other places in this patch.</p></blockquote></li><li>The current implementation totally ignores the symbolic ref such as <code>ref: refs/heads/main</code>.<blockquote><p>In any case, the two checks are good ONLY for regular refs and not for symbolic refs.  The users are free to create symbolic refs next to their branches, e.g. here is a way to say, “among the maintenance tracks maint-2.30, maint-2.31, … maint-2.44, maint-2.45, what I consider the primary maintenance track is currently maint-2.45”.</p></blockquote></li><li>The current implementation should consider the real symbolic file.<blockquote><p>The caller also needs to be prepared to find a real symbolic link that is used as a symbolic ref.</p></blockquote></li><li>The content check is not proper.<blockquote><p>I do not think it is a good idea to suddenly redefine what a valid way to write object names in a loose ref file after ~20 years. it should be at most FSCK_WARN when it does not look like what <em>we</em> wrote.</p></blockquote></li><li>The current implementation does not interact with the fsck error levels at all.<blockquote><p>How well does this interact with the fsck error levels (aka fsck_msg_type), by the way?  It should be made to work well if the current design does not.</p></blockquote></li></ul><h2 id="Next-Plan"><a href="#Next-Plan" class="headerlink" title="Next Plan"></a>Next Plan</h2><p>The next plan is very clear now.</p><ul><li>Really understand what <code>git-fsck</code> does to know whether we should port some functions to ref part and also to find a way to interact with teh fsck error levels.</li><li>Enhance the current implementation to support regular file containing symbolic ref and symbolic link file.</li><li>Understand how <code>git-worktree</code> works and incorporate the worktree like <code>git-fsck</code>.</li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;What-I-Have-Done&quot;&gt;&lt;a href=&quot;#What-I-Have-Done&quot; class=&quot;headerlink&quot; title=&quot;What I Have Done&quot;&gt;&lt;/a&gt;What I Have Done&lt;/h2&gt;&lt;p&gt;This is the</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>GSoC-Community Bonding Period</title>
    <link href="https://luolibrary.com/2024/05/27/GSoC-Community-Bonding-Period/"/>
    <id>https://luolibrary.com/2024/05/27/GSoC-Community-Bonding-Period/</id>
    <published>2024-05-27T07:37:51.000Z</published>
    <updated>2024-05-27T07:38:26.705Z</updated>
    
    <content type="html"><![CDATA[<p>During the community bonding period, I engaged in various activities to familiarize myself with my mentors, the community, and the git codebase. I had video conferences with each of my two mentors, where we discussed not only how to quickly set up a basic infrastructure for reference consistency checks but also talked about our respective careers and technical exchanges. Additionally, we scheduled bi-weekly video meetings for ongoing synchronization.</p><p>At the same time, all mentors and contributors agreed to an online meeting on June 7th, allowing us to further familiarize ourselves with the community.</p><h2 id="Setup-the-Mutt-to-Improve-Productivity"><a href="#Setup-the-Mutt-to-Improve-Productivity" class="headerlink" title="Setup the Mutt to Improve Productivity"></a>Setup the Mutt to Improve Productivity</h2><p>To enhance the efficiency of handling emails in the community later on, I plan to implement the use of mutt on ArchLinux before the official coding begins, and I have written a blog post called <a href="https://luolibrary.com/2024/05/12/Use-Mutt-in-ArchLinux/">Use Mutt in ArchLinux</a> documenting the configuration process.</p><h2 id="Infrastructure-Implementation"><a href="#Infrastructure-Implementation" class="headerlink" title="Infrastructure Implementation"></a>Infrastructure Implementation</h2><p>Before the official GSoC coding period begins, I was ready to set up the architecture for reference consistency checks as envisioned in the proposal. The core idea is to add a callback to <code>ref_storage_be</code>, then add the functionality to check if the ref name is correct for the file backend, and add code in the <code>fsck.c</code> file for testing.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ref_storage_be</span> &#123;</span></span><br><span class="line">  ...</span><br><span class="line">  check_refs_fn *check_refs;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>My mentors, Patrick and Karthik, have already commented on the corresponding <a href="https://github.com/shejialuo/git/commit/d4c33868502f7a74066cc8bce9c78941b68f58cb">commit</a>, with the main issues focusing on the following aspects:</p><ol><li>The current commit should be split; the first commit should focus on the implementation of the infrastructure, and then the second commit should add the name check for the file backend.</li><li>Do not use refs code to enumerate through the refs here. The reason is that this function would hide broken references from us. Use <code>dir-iterator.h</code> to check <code>refs/</code>.</li><li>Suggestions for some naming changes.</li><li>The need to also check the refs of the worktree.</li></ol><h2 id="Next-Plan"><a href="#Next-Plan" class="headerlink" title="Next Plan"></a>Next Plan</h2><p>I have now essentially completed the coding for the infrastructure. The subsequent work mainly involves addressing the comments from my two mentors on the current commit, then cleaning up the code, and reviewing the code through PRs in my own <a href="https://github.com/shejialuo/git/">repository</a>.</p><p>Secondly, I will maintain an email in the community to organize all updated blogs, making it convenient for the community to promptly follow my updates and provide me with feedback.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;During the community bonding period, I engaged in various activities to familiarize myself with my mentors, the community, and the git</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>Use Mutt in ArchLinux</title>
    <link href="https://luolibrary.com/2024/05/12/Use-Mutt-in-ArchLinux/"/>
    <id>https://luolibrary.com/2024/05/12/Use-Mutt-in-ArchLinux/</id>
    <published>2024-05-12T15:00:17.000Z</published>
    <updated>2025-03-30T08:04:43.970Z</updated>
    
    <content type="html"><![CDATA[<p>I successfully configured the Mutt email client a long time ago. Many open-source communities continue to use mailing lists as their primary communication tool, making a plain text email client essential. Mutt is an excellent choice for this purpose. I wrote this blog post to deepen my understanding of Mutt’s processes and to share why it remains relevant and useful in today’s digital communication landscape.</p><p>The following contents are cited from Mutt ArchWiki:</p><blockquote><p>Mutt focuses primarily on being a Mail User Agent (MUA), and was originally written to view mail. Later implementations (added for retrieval, sending, and filtering mail) are simplistic compared to other mail applications and, as such, users may wish to use external applications to extend Mutt’s capabilities.</p><p>Nevertheless, the Arch Linux mutt package is compiled with IMAP, POP3 and SMTP support, removing the necessity for external applications.</p></blockquote><p>Although the ArchLinux mutt package includes SMTP protocol functionality, which could simplify email management, I have decided to stick with the traditional way of using Mutt. This approach allows me to fully understand and control the email handling process, ensuring that I can customize and optimize it according to my specific needs.</p><p>I decide to use the following softwares in Arch Linux (It should work in any UNIX-like environment).</p><ul><li><a href="https://www.fetchmail.info/">fetchmail</a>. It is a mail-retrieval and forwarding utility; it fetches mail from remote mail servers and forwards it to your local machine’s delivery system.</li><li><a href="https://github.com/BuGlessRB/procmail">procmail</a>. A program for filtering, sorting and storing email.</li><li><a href="https://github.com/muttmua/mutt">Mutt</a>. The MUA.</li><li><a href="https://marlam.de/msmtp/">msmtp</a>. A simple SMTP client.</li></ul><h2 id="The-Usage-of-fetchmail"><a href="#The-Usage-of-fetchmail" class="headerlink" title="The Usage of fetchmail"></a>The Usage of fetchmail</h2><p>It’s not hard to use <code>fetchmail</code>. You should carefully read its <a href="https://www.fetchmail.info/fetchmail-man.html">manual</a>. It will explain everything you need.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#  QQMail (FoxMail)</span><br><span class="line">poll imap.qq.com protocol IMAP user &quot;392499367@qq.com&quot; password &quot;&quot; ssl keep</span><br><span class="line">mimedecode</span><br><span class="line">mda &quot;/usr/bin/procmail -f %F -d %T&quot;</span><br><span class="line"></span><br><span class="line"># GMail</span><br><span class="line">poll imap.gmail.com protocol IMAP user &quot;shejialuo@gmail.com&quot; password &quot;&quot; ssl keep</span><br><span class="line">mimedecode</span><br><span class="line">mda &quot;/usr/bin/procmail -f %F -d %T&quot;</span><br></pre></td></tr></table></figure><p>The <code>fetchmail</code> will eventually call <code>procmail</code> for directing the emails.</p><h2 id="The-Usage-of-procmail"><a href="#The-Usage-of-procmail" class="headerlink" title="The Usage of procmail"></a>The Usage of procmail</h2><p>The functionality of <code>procmail</code> is very powerful. However, power sometimes can cause a lot of trouble. So, I only use <code>procmail</code> to put the received email into the corresponding inbox.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">MAILDIR=$HOME</span><br><span class="line">VERBOSE=off</span><br><span class="line">LOGFILE=/tmp/procmaillog</span><br><span class="line"></span><br><span class="line">:0</span><br><span class="line">* ^TO392499367@qq\.com</span><br><span class="line">Mail/QQMail/inbox/</span><br><span class="line"></span><br><span class="line">:0</span><br><span class="line">* ^TOshejialuo@foxmail\.com</span><br><span class="line">Mail/QQMail/inbox/</span><br><span class="line"></span><br><span class="line">:0</span><br><span class="line">* ^(To|Cc):.*git@vger\.kernel\.org</span><br><span class="line">* ^TOshejialuo@gmail\.com</span><br><span class="line">Mail/GMail/mailing_list/git/</span><br><span class="line"></span><br><span class="line">:0</span><br><span class="line">* ^From:.*@google\.com</span><br><span class="line">* ^TOshejialuo@gmail\.com</span><br><span class="line">Mail/GMail/information/google/</span><br><span class="line"></span><br><span class="line">:0</span><br><span class="line">* ^From:.*@apple\.com</span><br><span class="line">* ^TOshejialuo@gmail\.com</span><br><span class="line">Mail/GMail/information/apple/</span><br><span class="line"></span><br><span class="line">:0</span><br><span class="line">* ^From:.*@github\.com</span><br><span class="line">* ^TOshejialuo@gmail\.com</span><br><span class="line">Mail/GMail/information/github/</span><br><span class="line"></span><br><span class="line">:0</span><br><span class="line">* ^From:.*@wakatime\.com</span><br><span class="line">* ^TOshejialuo@gmail\.com</span><br><span class="line">Mail/GMail/information/wakatime/</span><br><span class="line"></span><br><span class="line">:0</span><br><span class="line">* ^From:.*@wakatime\.com</span><br><span class="line">* ^TOshejialuo@gmail\.com</span><br><span class="line">Mail/GMail/information/steam/</span><br><span class="line"></span><br><span class="line">:0</span><br><span class="line">* ^TO*shejialuo@gmail.com*</span><br><span class="line">Mail/GMail/inbox/</span><br><span class="line"></span><br><span class="line">:0：</span><br><span class="line">Mail/spam</span><br></pre></td></tr></table></figure><p>The configuration described above is straightforward. It efficiently examines both the To and Cc fields of an email and directs the message to the appropriate folder accordingly.</p><h2 id="The-Usage-of-mstmp"><a href="#The-Usage-of-mstmp" class="headerlink" title="The Usage of mstmp"></a>The Usage of mstmp</h2><p>It’s still not so hard to configure the <code>mstmp</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># QQMail (FoxMail)</span><br><span class="line">account QQMail</span><br><span class="line">    auth login</span><br><span class="line">    host smtp.qq.com</span><br><span class="line">    port 587</span><br><span class="line">    from 392499367@qq.com</span><br><span class="line">    user 392499367@qq.com</span><br><span class="line">    password &quot;&quot;</span><br><span class="line">    tls on</span><br><span class="line">    tls_certcheck off</span><br><span class="line"></span><br><span class="line"># GMail</span><br><span class="line">account GMail</span><br><span class="line">    auth login</span><br><span class="line">    host smtp.gmail.com</span><br><span class="line">    port 587</span><br><span class="line">    from shejialuo@gmail.com</span><br><span class="line">    user shejialuo@gmail.com</span><br><span class="line">    password &quot;&quot;</span><br><span class="line">    tls on</span><br><span class="line">    tls_certcheck on</span><br><span class="line"></span><br><span class="line">logfile /tmp/msmtp.log</span><br></pre></td></tr></table></figure><h2 id="The-Usage-of-Mutt"><a href="#The-Usage-of-Mutt" class="headerlink" title="The Usage of Mutt"></a>The Usage of Mutt</h2><h3 id="Theme"><a href="#Theme" class="headerlink" title="Theme"></a>Theme</h3><p>I use the <a href="https://github.com/dracula/mutt">dracula theme</a>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Dracular color theme</span><br><span class="line">source ~/.config/mutt/dracula.muttrc</span><br></pre></td></tr></table></figure><h3 id="Basic-Configuration"><a href="#Basic-Configuration" class="headerlink" title="Basic Configuration"></a>Basic Configuration</h3><p>The configuration could be very different for different people. I simply put my configuration below. You’d better use the <code>man muttrc</code> to change the configuration for whatever you like.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># Use directory by default instead of a single file</span><br><span class="line">set mbox_type=Maildir</span><br><span class="line"></span><br><span class="line"># The default directory to save attach_save_dirachments from the &quot;attachment&quot; menu.</span><br><span class="line">set attach_save_dir = ~/.config/mutt/attachments</span><br><span class="line"></span><br><span class="line"># When this variable is set, mutt will beep when an error occurs.</span><br><span class="line">set beep = no</span><br><span class="line"></span><br><span class="line"># Character set your terminal uses to display and enter textual data</span><br><span class="line">set charset = &quot;utf-8&quot;</span><br><span class="line"></span><br><span class="line"># This option allows you to edit the header of your outgoing messages along with</span><br><span class="line"># the body of your message.</span><br><span class="line">set edit_headers=yes</span><br><span class="line"></span><br><span class="line"># This variable specifies which editor is used by mutt.</span><br><span class="line">set editor=&quot;vim&quot;</span><br><span class="line"></span><br><span class="line"># Controls whether or not a copy of the messages you are replying to is</span><br><span class="line"># included in your reply.</span><br><span class="line">set include = yes</span><br><span class="line"></span><br><span class="line"># When set, mutt will set the envelope sender of the message.</span><br><span class="line">set use_envelope_from = yes</span><br><span class="line"></span><br><span class="line"># This variable specifies what real name should be used when</span><br><span class="line"># sending messages.</span><br><span class="line">set realname=&quot;shejialuo&quot;</span><br><span class="line"></span><br><span class="line"># Specifies how to sort messages in the &quot;index&quot; menu</span><br><span class="line">set sort = threads</span><br><span class="line"></span><br><span class="line"># Controls whether or not Mutt will move read messages from your spool mailbox to your</span><br><span class="line"># $mbox mailbox</span><br><span class="line">set move = yes</span><br></pre></td></tr></table></figure><h3 id="Use-w3m-To-View-HTML-Content"><a href="#Use-w3m-To-View-HTML-Content" class="headerlink" title="Use w3m To View HTML Content"></a>Use w3m To View HTML Content</h3><p>I don’t want to use external browser to view HTML content. I use <a href="https://fiasko.io/projects/htmail-view.html.en">Reading html email with mutt</a> as the reference to setup. It’s not hard.</p><p>We need to first change the <code>mutt</code> configuration like the following:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Set w3m to view html content</span><br><span class="line">auto_view text/html</span><br><span class="line">alternative_order text/plain text/enriched text/html</span><br></pre></td></tr></table></figure><p>And the add the following content to the <code>~/.mailcap</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text/html; w3m -I %&#123;charset&#125; -T text/html; copiousoutput;</span><br></pre></td></tr></table></figure><h3 id="Use-Zathura-to-View-PDF-File"><a href="#Use-Zathura-to-View-PDF-File" class="headerlink" title="Use Zathura to View PDF File"></a>Use Zathura to View PDF File</h3><p>Append the following content to the <code>~/.mailcap</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">application/pdf; zathura %s;</span><br></pre></td></tr></table></figure><h3 id="Vim-Bindings"><a href="#Vim-Bindings" class="headerlink" title="Vim Bindings"></a>Vim Bindings</h3><p>Please refer to this wonderful blog <a href="https://ryanlue.com/posts/2017-05-21-mutt-the-vim-way">Mutt, the Vim Way</a>.</p><h3 id="Multiple-Accounts-Support"><a href="#Multiple-Accounts-Support" class="headerlink" title="Multiple Accounts Support"></a>Multiple Accounts Support</h3><p>We could use Mutt hook functionality to support multiple accounts. For multiple accounts, you must use <em>account-hooks</em> and <em>folder-hooks</em>.</p><ul><li><em>Folder-hooks</em> will run a command before switching folders. This is mostly useful to set the appropriate SMTP parameters when you are in a specific folder. For instance when you are in your work mailbox and you send an e-mail, it will automatically use your work account as sender.</li><li><em>Account-hooks</em> will run a command every time Mutt calls a function related to an account, like IMAP syncing. It does not require you to switch to any folder.</li></ul><p>I use folder-hooks because there is no account configuration for mutt. I use Gmail as the master configuration in <code>muttrc</code> like the following:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># GMail as the master</span><br><span class="line">source ~/.config/mutt/accounts/GMail</span><br><span class="line"></span><br><span class="line"># Multiple Accounts support</span><br><span class="line">folder-hook ~/Mail/GMail/* source ~/.config/mutt/accounts/GMail</span><br><span class="line">folder-hook ~/Mail/QQMail/* source ~/.config/mutt/accounts/QQMail</span><br></pre></td></tr></table></figure><p>Below is a full example for GMail and QQMail.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># ~/.config/mutt/accounts/GMail</span><br><span class="line"></span><br><span class="line">set from = &quot;shejialuo@gmail.com&quot;</span><br><span class="line">set sendmail = &quot;/usr/bin/msmtp -a GMail&quot;</span><br><span class="line">set spoolfile=&quot;$HOME/Mail/GMail/inbox&quot;</span><br><span class="line">set mbox=&quot;$HOME/Mail/GMail/seen&quot;</span><br><span class="line">set record=&quot;$HOME/Mail/GMail/sent&quot;</span><br><span class="line">set postponed=&quot;$HOME/Mail/GMail/draft&quot;</span><br><span class="line"></span><br><span class="line"># vim: ft=muttrc:</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"># ~/.config/mutt/accounts/QQMail</span><br><span class="line">set from = &quot;392499367@qq.com&quot;</span><br><span class="line">set sendmail = &quot;/usr/bin/msmtp -a QQMail&quot;</span><br><span class="line">set spoolfile = &quot;$HOME/Mail/QQMail/inbox&quot;</span><br><span class="line">set mbox=&quot;$HOME/Mail/QQMail/seen&quot;</span><br><span class="line">set record=&quot;$HOME/Mail/QQMail/sent&quot;</span><br><span class="line">set postponed=&quot;$HOME/Mail/QQMail/draft&quot;</span><br><span class="line"></span><br><span class="line"># vim: ft=muttrc:</span><br></pre></td></tr></table></figure><h2 id="Create-Mail-Directories"><a href="#Create-Mail-Directories" class="headerlink" title="Create Mail Directories"></a>Create Mail Directories</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># spam</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/spam/&#123;cur,new,tmp&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># QQMail</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/QQMail/inbox/&#123;cur,new,tmp&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/QQMail/draft/&#123;cur,new,tmp&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/QQMail/seen/&#123;cur,new,tmp&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/QQMail/sent/&#123;cur,new,tmp&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># GMail</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/GMail/inbox/&#123;cur,new,tmp&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/GMail/draft/&#123;cur,new,tmp&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/GMail/seen/&#123;cur,new,tmp&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/GMail/sent/&#123;cur,new,tmp&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/GMail/information</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/Mail/GMail/mailing_list</span><br></pre></td></tr></table></figure><h2 id="Common-Operations"><a href="#Common-Operations" class="headerlink" title="Common Operations"></a>Common Operations</h2><h3 id="Read-Raw-Mailbox"><a href="#Read-Raw-Mailbox" class="headerlink" title="Read Raw Mailbox"></a>Read Raw Mailbox</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">muut -f /tmp/a</span><br></pre></td></tr></table></figure><h3 id="Send-the-Patches"><a href="#Send-the-Patches" class="headerlink" title="Send the Patches"></a>Send the Patches</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> *.patch; <span class="keyword">do</span> proxychains4 mutt -H <span class="string">&quot;<span class="variable">$p</span>&quot;</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://wiki.archlinux.org/title/mutt">Mutt ArchWiki</a></li><li><a href="https://www.fetchmail.info/fetchmail-man.html">Fetchmail Manual</a></li><li><a href="https://fiasko.io/projects/htmail-view.html.en">Reading html email with mutt</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;I successfully configured the Mutt email client a long time ago. Many open-source communities continue to use mailing lists as their</summary>
        
      
    
    
    
    <category term="工具" scheme="https://luolibrary.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="技术" scheme="https://luolibrary.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>GSoC 2024 - Implement consistency check for refs</title>
    <link href="https://luolibrary.com/2024/05/03/GSoC-2024-Implement-consistency-check-for-refs/"/>
    <id>https://luolibrary.com/2024/05/03/GSoC-2024-Implement-consistency-check-for-refs/</id>
    <published>2024-05-03T09:02:53.000Z</published>
    <updated>2024-08-25T14:46:05.037Z</updated>
    
    <content type="html"><![CDATA[<p>I am fortunate to participate in <a href="https://summerofcode.withgoogle.com/programs/2024/projects/ukm4PTEF">GSoC 2024</a> contributing to <a href="https://git-scm.com/">Git</a>. This opportunity not only allows me to engage with one of the most influential open-source projects but also enables me to work under the guidance of experienced developers in the field.</p><p>I would like to extend my deepest gratitude to my two mentors, <a href="https://github.com/pks-t">Patrick</a> and <a href="https://github.com/KarthikNayak">Karthik</a>, who are both esteemed developers at <a href="https://about.gitlab.com/">GitLab</a>. Their expertise and guidance are invaluable, and I am incredibly fortunate to have the opportunity to learn from such experienced professionals in the field.</p><p>The primary purpose of this page is to serve as an archive for my weekly reports throughout the GSoC journey. These reports will detail my progress, challenges encountered, solutions devised, and learnings acquired each week. The intention behind maintaining this archive is twofold:</p><ol><li><strong>Transparency</strong>: To keep a transparent record of my contributions and progress throughout the project. This will allow my mentors, peers, and anyone interested in the project to track its development and my growth as a developer.</li><li><strong>Reflection</strong>: To serve as a reflective journal for myself. Documenting my journey will help me analyze my approaches, celebrate milestones, and learn from the challenges I face.</li></ol><p>You may access all related pages by visiting the <a href="https://luolibrary.com/categories/GSoC-2024/">GSoC 2024 category</a>.</p><h2 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h2><ol><li><a href="https://luolibrary.com/2024/05/27/GSoC-Community-Bonding-Period/">Community Bonding Period</a></li><li><a href="https://luolibrary.com/2024/06/02/GSoC-Week-1/">GSoC Week 1</a></li><li><a href="https://luolibrary.com/2024/06/10/GSoC-Week-2/">GSoC Week 2</a></li><li><a href="https://luolibrary.com/2024/06/17/GSoC-Week-3/">GSoC Week 3</a></li><li><a href="https://luolibrary.com/2024/06/30/GSoC-Week-4-5/">GSoC Week 4-5</a></li><li><a href="https://luolibrary.com/2024/07/08/GSoC-Week-6/">GSoC Week 6</a></li><li><a href="https://luolibrary.com/2024/07/16/GSoC-Week-7/">GSoC Week 7</a></li><li><a href="https://luolibrary.com/2024/07/28/GSoC-Week-8-9/">GSoC Week 8-9</a></li><li><a href="https://luolibrary.com/2024/08/13/GSoC-Week-10-11/">GSoC Week 10-11</a></li><li><a href="https://luolibrary.com/2024/08/25/GSoC-Final-Report/">GSoC Final Report</a></li></ol>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;I am fortunate to participate in &lt;a href=&quot;https://summerofcode.withgoogle.com/programs/2024/projects/ukm4PTEF&quot;&gt;GSoC 2024&lt;/a&gt;</summary>
        
      
    
    
    
    <category term="GSoC 2024" scheme="https://luolibrary.com/categories/GSoC-2024/"/>
    
    
    <category term="GSoC" scheme="https://luolibrary.com/tags/GSoC/"/>
    
  </entry>
  
  <entry>
    <title>2023年终总结</title>
    <link href="https://luolibrary.com/2024/01/31/2023%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>https://luolibrary.com/2024/01/31/2023%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2024-01-31T15:41:28.000Z</published>
    <updated>2024-01-31T15:41:44.170Z</updated>
    
    <content type="html"><![CDATA[<p>2023年的尾声早就已经过了，时间总是如同利刃一般无情地划过。我坐在西电网安大楼的实验室中，脑袋已经相当沉重了。突然想着必须记录2023年，为什么呢？内心不禁发问。我想我必须记录自己的存在。时间总是无痕，我必须在这个无痕且透明的世界里面，刻下属于我的痕迹。</p><h2 id="逃离"><a href="#逃离" class="headerlink" title="逃离"></a>逃离</h2><p>我为什么第一个想到的词就是逃离呢？因为我自己在2023年4月份的时候，已经疲倦了。每当疲倦的时候，我都不禁地反问自己，打代码的意义是什么呢？在面实习的过程中基本没有得到什么正反馈，不知道自己该为何而战。心里开始烦躁了，焦急了，幸福的口袋似乎什么东西都没有装下。不经让我想起《Rewrite》游戏里面的经典话语：</p><blockquote><p>有一天，察觉到自己一无所有。</p><p>发现本以为堆满着幸福的口袋，其实空无一物。</p><p>因为我没为在口袋里塞些什么而努力，所以是理所当然的。</p></blockquote><p>我一直以打代码自豪，这是我重要的存在意义。然而，我深刻地记得我当时对自我的怀疑，我真的能够打代码一辈子吗？我真的喜欢代码吗？我真的不是通过代码来逃避自我吗？我很迷惘。于是乎我决定逃离，本来不打算五一回家的我，以逃离为目的踏上了回家的旅程。</p><h3 id="与挚友的交谈"><a href="#与挚友的交谈" class="headerlink" title="与挚友的交谈"></a>与挚友的交谈</h3><p>从西安到成都的高铁很快，我简单地背了个包就回到了成都。和我的挚友见面了，他仍然是往常一样，我也如往常一样。吃喝玩乐过后，我和他在他那租的一套一里面聊着天。我们从初中聊到高中再聊到大学，我第一次知道了他在初中的细腻情感，第一次知道了他在高中时候将自己的情感诉诸于暴力的悔恨。我许久没有如此真挚的聊天了。我不仅又反思了自己的傲慢与偏见，我们真的能够轻易地了解一个人吗？我们总是凭借一些自己或他人的所见，就轻易对一个人下定义。</p><p>不禁意间，天就变亮了，我的挚友给我说不要逃避自己的感情，既然无法开辟一段新的未来，就认真地审视自己的过去。我一下就想到了我这次回家的主题：<strong>逃离</strong>。我不由黯然伤神。这几年，我不知道自己是否前进了。我的一些朋友一直认为我是在原地踏步，说实话，我很讨厌听到这样的话。但是反过来想，如果是一个不那么了解我的人，也确实很容易得出这样的结论。</p><h3 id="回家的反思"><a href="#回家的反思" class="headerlink" title="回家的反思"></a>回家的反思</h3><p>家永远是最温暖的港湾，不论哪个时间回家都会有这样的感慨。和父母聊了聊天，见了见外公，吃到了熟悉的香味。我的烦恼与疑惑已然被抛在了脑后。然而，我不由自主地又翻阅了我和曾经的她在高中时期写的书信，所有的信都用一种巧妙的方式送回到了我的手里。我每次都觉得这是命运使然，似乎可能在那时她就已经决定分手了。</p><p>我每次看信的内容，涌起的都是极其复杂的感情。好的方面有对往日回忆的追忆，对昔日温暖的遗憾。坏的方面，我不禁质疑这份感情的真假，我无法分清什么是假什么是真。每次一想到这个，我感觉到极其的厌倦，爱过的人和事物为什么这么让人扫兴。</p><p>五一节和另外的挚友相见了，我说起了我的迷惘，对代码的疑惑，自己能否将其作为终生的事业而奋斗呢？对困扰自己多年的感情的疑惑，自己是真的在前进，还是在逃避自己的内心呢？</p><h3 id="重返重庆"><a href="#重返重庆" class="headerlink" title="重返重庆"></a>重返重庆</h3><p>为什么突然想去重庆呢？没有理由，就是想去了。见到了自己的大学室友，他没什么变化，一如既往地真诚。我才明白我追求的是什么，我希望能与人建立真诚的关系，希望我真诚待别人，也希望别人真诚待我。然而，我追求的这个东西确实这个世间最为宝贵的东西，我矛盾的地方就在于明知有些东西难以强求却想强求。</p><p>回到了自己本科的母校，见到了那个时候对我启发甚大的学业导师。他仍然是对科研保留着属于他的纯粹。我很羡慕他，我觉得我的科研生涯完全没有去解决过一个真正的科学问题，从来没有去探索过计算机科学应该去解决的问题。他推荐我去滑铁卢大学读博士，我说我硕士期间的科研素养积累的不够，他批评了我的想法，我现在都记得他的话语：</p><blockquote><p>你为什么不去看看国外是怎么搞科研的呢？如果你觉得不合适，退学就行了啊。而且去国外体会一下别人的文化，别人的生活，感受一下也是一个好事。</p></blockquote><p>我才意识到自己的局限性，才意识到自己在西电读研失去的一个最宝贵的东西：<strong>勇气</strong>。我自己扼杀了自己的可能性。我老师问我，你觉得一个博士最重要的是什么？我已经忘记我怎么回答的呢？他给我说了一个我很震撼的话，博士最重要的是去研究真正的科学问题。实际上，我在读研之前他应该也给我说过，但是在当时我很难理解这句话的真正含义。我不禁再次反思，我想成为一个纯粹的人，然而我的逃离证明了我对代码并不纯粹。</p><p>当我沉溺于另一个世界中的时候，我另一位朋友带着她的男朋友来了西安，突然将我从这段妄想拉回了现实，我急忙买了一张从重庆到西安的动车票回到了西安。似乎给我这段旅程画上了句号。</p><h2 id="正视"><a href="#正视" class="headerlink" title="正视"></a>正视</h2><p>五一的逃离让我认识了许多东西，我才发现所谓的实习和秋招我不应该焦虑，我保持我自己，做好我自己该做的事情。</p><ul><li>ehForwarderBot社区贡献：抽空认真地阅读了<code>efb-qq-plugin-go-cqhttp</code>的源码，给所有的方法添加了注解，并提供了发送文件和视频的功能。</li><li>database-systems-complete-book-solutions：基本完成了这本讲数据库原理的课后习题答案。</li></ul><p>当时我自己也学了很多东西，毕竟我还是很热爱coding的。</p><h2 id="婚礼"><a href="#婚礼" class="headerlink" title="婚礼"></a>婚礼</h2><p>来西安的朋友结婚了，在9月份给我发了请帖国庆她要结婚了，我由衷地为她感到高兴，她找到了属于自己的归宿。我曾经去过她家拜访，那个时候我只觉得自己格格不入，那种生活的气息甚至让我觉得有些许的窒息。我突然意识到自己是不是离小小的幸福越来越远了。</p><p>本以为能高兴去参加的婚礼，更多的却是给自己带来的痛苦。当我知道伴娘是我的前女友的时候，内心是一丝丝的期待，主要是好奇这五年的时间她变成了一个什么样的人。同时，我也很想见我的哥们儿。来到成都东站的时候，兄弟们已经在等着我了，然而殊不知噩梦才刚刚开始。</p><p>到了婚礼前一天晚上的时候，我一个哥们儿突然说，我的前女友叫我们过去玩。实际上，对于我来说我的内心是不愿意的，我或多或少觉得有点尴尬。我不知道我该说些什么，所以在与她见面的那一瞬间，我有逃避的想法，不过既然来了，肯定不能逃避了，我现在都能清晰地记得我内心所说的话：</p><blockquote><p>人不能逃避自我。</p></blockquote><p>然而，我的前女友只叫了我另外四个兄弟的名字，而忽略了我的名字，我一瞬间就语塞了。因为我的存在在此时此刻已经被她恶意地抽离了。于是乎，大家热烈地讨论明天早上堵门的事情，商量着小游戏该如何安排，而我并不存在，这让我第一次意识到了我似乎成为了《局外人》这本小说的主人公。只不过，他是主动的，而我是被动的。最讽刺的是，我一个兄弟对我所说的话：</p><blockquote><p>这么多年了，你还没走出来吗？</p></blockquote><p>我已经无法解释什么了，我第一次意识到了距离。然而，也是有开心的事情。第二天我听到新娘的致辞的时候，我才明白这份幸福属于她是应该的。真挚的情感表达，她放弃成为一个医生，选择了其他职业，感谢了她的父母对她职业选择的理解。感谢与她老公的相遇。说实话，我的眼睛湿润了，唯独真挚的情感能让人心震撼。</p><p>结婚的当天下午，他们都去打牌了，我自己选择了逃离。把我的MBP打开，写了一下午的MIT 6.824。这可谓是我最快乐的时光了，我终于找回了属于自己的存在。我从来不讨厌孤独一人，而是厌恶被人恶意的孤立。</p><p><img src="https://s2.loli.net/2024/01/31/E1LtaWz9ycKrGBj.png" alt="10月4日的提交记录"></p><h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><p>人生第一次参加了真正意义上的工作，然而第一份实习在NVIDIA，可能直接会把我惯坏吧。不如说已经把我惯坏了。上班的体验是很好的，然而晚上一个人待在上海小小的出租屋里面，感受到的确实实在的寂寞。突然急切地希望自己身边能有一个人陪伴，然而我却厌恶自己的想法，如果是因为寂寞就去靠近一个人，对她来说这是一个不公平的事情。所以由衷地觉得，晚上的时间要好好把握。要去充实自己的生活。不禁苦笑，说总是比做起来容易。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>人的一年说多也多，说少也少。然而，正如我开头所讲，简单地记录自己的存在。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;2023年的尾声早就已经过了，时间总是如同利刃一般无情地划过。我坐在西电网安大楼的实验室中，脑袋已经相当沉重了。突然想着必须记录2023年，为什么呢？内心不禁发问。我想我必须记录自己的存在。时间总是无痕，我必须在这个无痕且透明的世界里面，刻下属于我的痕迹。&lt;/p&gt;
&lt;h2</summary>
        
      
    
    
    
    <category term="随笔" scheme="https://luolibrary.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
  </entry>
  
</feed>
